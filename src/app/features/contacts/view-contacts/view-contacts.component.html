<div class="container mx-auto p-4 lg:p-8 max-w-7xl animate-fade-in">
    <!-- Header & Stats -->
    <div class="flex flex-col gap-8 mb-8">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div>
                <h1 class="text-3xl font-bold text-text-primary mb-2">Messages</h1>
                <p class="text-text-tertiary">Manage your inbox and communications</p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3 w-full lg:w-auto" *ngIf="stats()">
                <div
                    class="glass-panel px-4 py-3 rounded-2xl border border-border/50 bg-surface/50 backdrop-blur-sm flex flex-col items-center min-w-[100px] hover:bg-surface-elevated transition-colors">
                    <span class="text-[10px] font-bold uppercase text-text-tertiary tracking-wider">Total</span>
                    <span class="text-xl font-bold text-text-primary mt-1">{{ stats()?.overview?.totalContacts || 0
                        }}</span>
                </div>
                <div
                    class="glass-panel px-4 py-3 rounded-2xl border border-primary/20 bg-primary/5 backdrop-blur-sm flex flex-col items-center min-w-[100px] hover:bg-primary/10 transition-colors">
                    <span class="text-[10px] font-bold uppercase text-primary tracking-wider">New</span>
                    <span class="text-xl font-bold text-text-primary mt-1">{{ stats()?.overview?.newContacts || 0
                        }}</span>
                </div>
                <div
                    class="glass-panel px-4 py-3 rounded-2xl border border-border/50 bg-surface/50 backdrop-blur-sm flex flex-col items-center min-w-[100px] hover:bg-surface-elevated transition-colors">
                    <span class="text-[10px] font-bold uppercase text-text-tertiary tracking-wider">Read</span>
                    <span class="text-xl font-bold text-text-primary mt-1">{{ stats()?.overview?.readContacts || 0
                        }}</span>
                </div>
                <div
                    class="glass-panel px-4 py-3 rounded-2xl border border-secondary/20 bg-secondary/5 backdrop-blur-sm flex flex-col items-center min-w-[100px] hover:bg-secondary/10 transition-colors">
                    <span class="text-[10px] font-bold uppercase text-secondary tracking-wider">Replied</span>
                    <span class="text-xl font-bold text-text-primary mt-1">{{ stats()?.overview?.repliedContacts || 0
                        }}</span>
                </div>
                <div
                    class="glass-panel px-4 py-3 rounded-2xl border border-success/20 bg-success/5 backdrop-blur-sm flex flex-col items-center min-w-[100px] hover:bg-success/10 transition-colors">
                    <span class="text-[10px] font-bold uppercase text-success tracking-wider">Closed</span>
                    <span class="text-xl font-bold text-text-primary mt-1">{{ stats()?.overview?.closedContacts || 0
                        }}</span>
                </div>
                <div
                    class="glass-panel px-4 py-3 rounded-2xl border border-error/20 bg-error/5 backdrop-blur-sm flex flex-col items-center min-w-[100px] hover:bg-error/10 transition-colors">
                    <span class="text-[10px] font-bold uppercase text-error tracking-wider">Spam</span>
                    <span class="text-xl font-bold text-text-primary mt-1">{{ stats()?.overview?.spamContacts || 0
                        }}</span>
                </div>
            </div>
        </div>

        <!-- Filters & Search -->
        <div
            class="glass-panel p-4 rounded-2xl border border-border/50 bg-surface flex flex-col md:flex-row gap-4 justify-between items-center">
            <!-- Search -->
            <div class="relative w-full md:w-96">
                <i class="fa-solid fa-search absolute left-4 top-1/2 -translate-y-1/2 text-text-tertiary"></i>
                <input type="text" [ngModel]="searchTerm()" (ngModelChange)="onSearch($event)"
                    placeholder="Search messages..."
                    class="w-full pl-10 pr-4 py-3 bg-surface-elevated/50 border border-border/60 rounded-xl text-text-primary focus:outline-none focus:ring-1 focus:ring-primary/20 focus:border-primary transition-all" />
            </div>

            <!-- Filter Buttons -->
            <div class="flex gap-2 overflow-x-auto w-full md:w-auto pb-2 md:pb-0">
                <button (click)="setStatusFilter('')" [class.bg-primary]="statusFilter() === ''"
                    [class.text-white]="statusFilter() === ''" [class.bg-surface-elevated]="statusFilter() !== ''"
                    class="px-4 py-2 rounded-lg text-sm font-medium transition-colors border border-border/50 whitespace-nowrap">
                    All
                </button>
                <button (click)="setStatusFilter('new')" [class.bg-primary]="statusFilter() === 'new'"
                    [class.text-white]="statusFilter() === 'new'" [class.bg-surface-elevated]="statusFilter() !== 'new'"
                    class="px-4 py-2 rounded-lg text-sm font-medium transition-colors border border-border/50 whitespace-nowrap">
                    New
                </button>
                <button (click)="setStatusFilter('read')" [class.bg-primary]="statusFilter() === 'read'"
                    [class.text-white]="statusFilter() === 'read'"
                    [class.bg-surface-elevated]="statusFilter() !== 'read'"
                    class="px-4 py-2 rounded-lg text-sm font-medium transition-colors border border-border/50 whitespace-nowrap">
                    Read
                </button>
                <button (click)="setStatusFilter('replied')" [class.bg-primary]="statusFilter() === 'replied'"
                    [class.text-white]="statusFilter() === 'replied'"
                    [class.bg-surface-elevated]="statusFilter() !== 'replied'"
                    class="px-4 py-2 rounded-lg text-sm font-medium transition-colors border border-border/50 whitespace-nowrap">
                    Replied
                </button>
            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="glass-panel rounded-2xl border border-border/50 bg-surface overflow-hidden min-h-[400px]">

        <!-- Loading State -->
        <div *ngIf="isLoading()" class="flex flex-col items-center justify-center p-12">
            <span class="loading loading-spinner loading-lg text-primary"></span>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoading() && (!contacts() || contacts().length === 0)"
            class="flex flex-col items-center justify-center p-12 text-center">
            <div class="w-16 h-16 rounded-full bg-surface-elevated flex items-center justify-center mb-4">
                <i class="fa-regular fa-envelope-open text-2xl text-text-tertiary"></i>
            </div>
            <h3 class="text-lg font-bold text-text-primary mb-1">No messages found</h3>
            <p class="text-text-tertiary">Try adjusting your filters or search query</p>
        </div>

        <!-- List -->
        <div *ngIf="!isLoading() && contacts() && contacts().length > 0" class="divide-y divide-border/50">
            <div *ngFor="let contact of contacts()"
                class="p-4 hover:bg-surface-elevated/30 transition-colors group cursor-pointer"
                [ngClass]="{'bg-error/5': contact.isSpam}" [routerLink]="['/contacts', contact._id]">
                <div class="flex flex-col md:flex-row gap-4 items-start md:items-center">

                    <!-- Avatar/Icon -->
                    <div class="w-10 h-10 rounded-full flex items-center justify-center shrink-0" [ngClass]="{
              'bg-error/10 text-error': contact.isSpam,
              'bg-primary/10 text-primary': !contact.isSpam && contact.status === 'new',
              'bg-surface-elevated text-text-tertiary': !contact.isSpam && contact.status !== 'new'
            }">
                        <i class="fa-solid" [ngClass]="{
                            'fa-triangle-exclamation': contact.isSpam,
                            'fa-reply': !contact.isSpam && contact.status === 'replied',
                            'fa-envelope': !contact.isSpam && contact.status !== 'replied'
                        }"></i>
                    </div>

                    <!-- Info -->
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2 mb-1">
                            <h3 class="font-bold text-text-primary truncate"
                                [class.text-primary]="!contact.isSpam && contact.status === 'new'"
                                [class.text-error]="contact.isSpam">{{ contact.name }}</h3>

                            <!-- Spam Badge -->
                            <span *ngIf="contact.isSpam"
                                class="text-xs px-2 py-0.5 rounded-md border bg-error/10 text-error border-error/20 font-bold uppercase tracking-wider">
                                SPAM
                            </span>

                            <!-- Status Badge -->
                            <span *ngIf="!contact.isSpam" class="text-xs px-2 py-0.5 rounded-md border" [ngClass]="{
                  'bg-primary/10 text-primary border-primary/20': contact.status === 'new',
                  'bg-emerald-500/10 text-emerald-500 border-emerald-500/20': contact.status === 'replied',
                  'bg-surface-elevated text-text-tertiary border-border/50': contact.status === 'read' || contact.status === 'closed'
                }">
                                {{ contact.status }}
                            </span>
                            <span class="text-xs text-text-tertiary ml-auto md:ml-2">{{ contact.createdAt |
                                date:'mediumDate' }}</span>
                        </div>
                        <p class="text-sm font-medium text-text-primary mb-0.5 truncate">{{ contact.subject }}</p>
                        <p class="text-sm text-text-tertiary truncate">{{ contact.message }}</p>
                    </div>

                    <!-- Actions -->
                    <div class="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button (click)="markAsSpam(contact._id, $event)" title="Mark as Spam"
                            class="btn btn-ghost btn-sm btn-square text-warning hover:bg-warning/10">
                            <i class="fa-solid fa-triangle-exclamation"></i>
                        </button>
                        <button (click)="deleteContact(contact._id, $event)" title="Delete"
                            class="btn btn-ghost btn-sm btn-square text-error hover:bg-error/10">
                            <i class="fa-regular fa-trash-can"></i>
                        </button>
                        <i class="fa-solid fa-chevron-right text-text-tertiary ml-2"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pagination -->
    <div class="mt-8" *ngIf="pagination() && (pagination()?.pages || 0) > 1">
        <app-pagination [pagination]="pagination()!" (pageChange)="onPageChange($event)"></app-pagination>
    </div>
</div>