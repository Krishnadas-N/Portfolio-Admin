<div class="container mx-auto p-4 lg:p-8 max-w-5xl animate-fade-in" *ngIf="contact(); else loadingTpl">
    <!-- Header -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
        <div class="flex items-center gap-4">
            <a routerLink="/contacts" class="btn btn-circle btn-ghost text-text-tertiary hover:text-primary">
                <i class="fa-solid fa-arrow-left"></i>
            </a>
            <div>
                <h1 class="text-2xl font-bold text-text-primary">{{ contact()?.subject }}</h1>
                <div class="flex items-center gap-2 text-sm text-text-tertiary mt-1">
                    <span>From: <span class="text-text-primary font-medium">{{ contact()?.name }}</span> &lt;{{
                        contact()?.email }}&gt;</span>
                    <span class="w-1 h-1 rounded-full bg-border"></span>
                    <span>{{ contact()?.createdAt | date:'medium' }}</span>
                </div>
            </div>
        </div>

        <div class="flex items-center gap-2">
            <button (click)="markAsSpam()" class="btn btn-ghost text-text-tertiary hover:text-warning"
                title="Mark as Spam">
                <i class="fa-solid fa-triangle-exclamation"></i>
            </button>
            <button (click)="deleteContact()" class="btn btn-ghost text-text-tertiary hover:text-error" title="Delete">
                <i class="fa-regular fa-trash-can"></i>
            </button>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-8">
            <!-- Message Body -->
            <div class="glass-panel p-8 rounded-2xl border border-border/50 bg-surface">
                <div class="prose dark:prose-invert max-w-none text-text-primary whitespace-pre-wrap leading-relaxed">
                    {{ contact()?.message }}
                </div>
            </div>

            <!-- Reply Section -->
            <div class="glass-panel p-6 rounded-2xl border border-border/50 bg-surface">
                <h3 class="font-bold text-text-primary mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-reply text-primary"></i> Reply
                </h3>

                <div class="space-y-4">
                    <input type="text" [ngModel]="replySubject()" (ngModelChange)="replySubject.set($event)"
                        placeholder="Subject"
                        class="w-full px-4 py-3 bg-surface-elevated/50 border border-border/60 rounded-xl text-text-primary focus:outline-none focus:ring-1 focus:ring-primary/20 focus:border-primary transition-all" />

                    <textarea [ngModel]="replyMessage()" (ngModelChange)="replyMessage.set($event)" rows="6"
                        placeholder="Type your reply here..."
                        class="w-full px-4 py-3 bg-surface-elevated/50 border border-border/60 rounded-xl text-text-primary focus:outline-none focus:ring-1 focus:ring-primary/20 focus:border-primary transition-all resize-none"></textarea>

                    <div class="flex justify-end">
                        <button (click)="sendReply()" [disabled]="isSending() || !replyMessage()"
                            class="btn btn-primary px-8 gap-2">
                            <span *ngIf="isSending()" class="loading loading-spinner loading-sm"></span>
                            {{ isSending() ? 'Sending...' : 'Send Reply' }}
                            <i *ngIf="!isSending()" class="fa-solid fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">

            <!-- Status Card -->
            <div class="glass-panel p-6 rounded-2xl border border-border/50 bg-surface">
                <h3 class="text-xs font-bold text-text-tertiary uppercase tracking-widest mb-4">Status</h3>

                <div class="space-y-3">
                    <button *ngFor="let status of statusOptions" (click)="updateStatus(status)"
                        class="w-full flex items-center justify-between p-3 rounded-xl transition-all border"
                        [ngClass]="contact()?.status === status ? 'bg-primary/10 border-primary/20 text-primary' : 'bg-surface-elevated/50 border-transparent hover:border-border/50 text-text-secondary'">
                        <span class="capitalize font-medium">{{ status }}</span>
                        <i *ngIf="contact()?.status === status" class="fa-solid fa-check"></i>
                    </button>
                </div>
            </div>

            <!-- Contact Info -->
            <div class="glass-panel p-6 rounded-2xl border border-border/50 bg-surface">
                <h3 class="text-xs font-bold text-text-tertiary uppercase tracking-widest mb-4">Contact Details</h3>

                <div class="space-y-4 text-sm">
                    <div class="flex flex-col gap-1">
                        <span class="text-text-tertiary">Email</span>
                        <a [href]="'mailto:' + contact()?.email"
                            class="text-primary hover:underline font-medium break-all">{{ contact()?.email }}</a>
                    </div>

                    <div class="flex flex-col gap-1" *ngIf="contact()?.phone">
                        <span class="text-text-tertiary">Phone</span>
                        <a [href]="'tel:' + contact()?.phone" class="text-text-primary font-medium">{{ contact()?.phone
                            }}</a>
                    </div>

                    <div class="flex flex-col gap-1" *ngIf="contact()?.company">
                        <span class="text-text-tertiary">Company</span>
                        <span class="text-text-primary font-medium">{{ contact()?.company }}</span>
                    </div>

                    <div class="h-px bg-border/50 my-2"></div>

                    <div class="flex justify-between items-center">
                        <span class="text-text-tertiary">Priority</span>
                        <span class="badge badge-sm uppercase font-bold" [ngClass]="{
                'badge-error text-white': contact()?.priority === 'high',
                'badge-warning text-white': contact()?.priority === 'medium',
                'badge-ghost': contact()?.priority === 'low'
              }">{{ contact()?.priority }}</span>
                    </div>

                    <div class="flex justify-between items-center">
                        <span class="text-text-tertiary">Source</span>
                        <span class="text-text-primary capitalize">{{ contact()?.source }}</span>
                    </div>

                    <div class="flex justify-between items-center" *ngIf="contact()?.ipAddress">
                        <span class="text-text-tertiary">IP Address</span>
                        <span class="text-text-secondary font-mono text-xs">{{ contact()?.ipAddress }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<ng-template #loadingTpl>
    <div class="flex justify-center items-center min-h-[60vh]">
        <span class="loading loading-spinner loading-lg text-primary"></span>
    </div>
</ng-template>