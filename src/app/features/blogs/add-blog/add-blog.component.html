<div class="h-full flex flex-col p-6 max-w-[1920px] mx-auto w-full overflow-hidden">

  <!-- Header Actions (Not Sticky) -->
  <div class="flex flex-col sm:flex-row justify-between items-end sm:items-center gap-4 mb-8 shrink-0">
    <div>
      <h1 class="text-3xl font-bold text-text-primary tracking-tight">{{ isEditMode ? 'Edit Post' : 'New Post' }}</h1>
      <p class="text-text-secondary text-sm mt-1">Create or edit your blog content for the world.</p>
    </div>
    <div class="flex gap-3 w-full sm:w-auto">
      <button type="button" (click)="onCancel()"
        class="px-6 py-2.5 rounded-xl border border-border text-text-secondary hover:bg-surface-elevated hover:text-text-primary transition-all text-sm font-medium">Cancel</button>
      <button type="button" (click)="onSubmit()" [disabled]="blogForm.invalid || isSubmitting"
        class="px-6 py-2.5 rounded-xl bg-primary text-white hover:bg-primary-hover shadow-lg shadow-primary/25 hover:shadow-primary/40 transition-all text-sm font-medium flex items-center justify-center gap-2 transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
        <span *ngIf="isSubmitting" class="loading loading-spinner loading-xs"></span>
        <i class="fa-regular fa-floppy-disk" *ngIf="!isSubmitting"></i>
        <span>{{ isEditMode ? 'Save Changes' : 'Publish Post' }}</span>
      </button>
    </div>
  </div>

  <!-- Main Scrollable Content -->
  <div class="flex-1 overflow-y-auto custom-scrollbar min-h-0 pb-10">
    <div class="max-w-7xl mx-auto">
      <form [formGroup]="blogForm" class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <!-- Left Column (Main Content) -->
        <div class="lg:col-span-2 space-y-8">

          <!-- Title & Editor -->
          <div class="glass-panel p-6 sm:p-8 rounded-2xl border border-border/50 bg-surface">

            <!-- Title -->
            <div class="flex flex-col gap-2 mb-8">
              <label class="text-xs font-bold text-text-tertiary uppercase tracking-widest ml-1">Post Title</label>
              <input type="text" formControlName="title" placeholder="Enter a catchy title..."
                class="w-full px-5 py-4 bg-surface-elevated/50 border border-border/60 rounded-xl text-xl font-bold text-text-primary placeholder:font-normal placeholder:text-text-tertiary focus:outline-none focus:ring-1 focus:ring-primary/20 focus:border-primary transition-all"
                [class.border-red-500]="f['title'].touched && f['title'].invalid" />
              <span class="text-xs text-red-500 ml-1" *ngIf="f['title'].touched && f['title'].invalid">
                Title is required (min 5 chars)
              </span>
            </div>

            <!-- Editor -->
            <div class="flex flex-col gap-2" *ngIf="editorInitialized">
              <label class="text-xs font-bold text-text-tertiary uppercase tracking-widest ml-1">Content</label>
              <div
                class="border border-border/60 rounded-xl overflow-hidden focus-within:ring-1 focus-within:ring-primary/20 focus-within:border-primary transition-all bg-surface-elevated/30">
                <ngx-editor-menu [editor]="editor" [toolbar]="toolbar"
                  class="border-b border-border/60 bg-surface-elevated/50"></ngx-editor-menu>
                <ngx-editor [editor]="editor" formControlName="content"
                  [placeholder]="'Start writing your amazing story...'"
                  class="min-h-[400px] prose dark:prose-invert max-w-none p-6 focus:outline-none bg-transparent text-text-primary"></ngx-editor>
              </div>
              <span class="text-xs text-red-500 ml-1" *ngIf="f['content'].touched && f['content'].invalid">
                Content is required
              </span>
            </div>
          </div>

          <!-- Excerpt -->
          <div class="glass-panel p-6 sm:p-8 rounded-2xl border border-border/50 bg-surface">
            <h3 class="font-bold text-base mb-6 flex items-center gap-2 text-text-primary">
              <i class="fa-solid fa-quote-left text-primary"></i> Excerpt
            </h3>
            <textarea formControlName="excerpt"
              class="w-full px-4 py-3 bg-surface-elevated/50 border border-border/60 rounded-xl text-text-primary placeholder:text-text-tertiary focus:outline-none focus:ring-1 focus:ring-primary/20 focus:border-primary transition-all text-base leading-relaxed h-28 resize-none"
              placeholder="Write a short summary for SEO and cards..."></textarea>
            <div class="flex justify-between items-center mt-2 px-1">
              <span class="text-xs text-red-500" *ngIf="f['excerpt'].touched && f['excerpt'].invalid">Excerpt is
                required</span>
              <span class="text-xs text-text-tertiary ml-auto">Recommended: 150-160 characters</span>
            </div>
          </div>
        </div>

        <!-- Right Column (Sidebar) -->
        <div class="space-y-6">

          <!-- Publish Settings -->
          <div class="glass-panel p-6 rounded-2xl border border-border/50 bg-surface">
            <h3 class="text-xs font-bold text-text-tertiary uppercase tracking-widest mb-6">Publishing</h3>

            <div class="space-y-5">
              <div class="space-y-1.5">
                <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Status</label>
                <div class="relative">
                  <select formControlName="status"
                    class="w-full pl-4 pr-10 py-3 bg-surface-elevated/50 border border-border/60 rounded-xl text-text-primary focus:outline-none focus:ring-1 focus:ring-primary/20 focus:border-primary transition-all appearance-none cursor-pointer text-sm">
                    <option value="draft">Draft</option>
                    <option value="published">Published</option>
                  </select>
                  <i
                    class="fa-solid fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-text-tertiary pointer-events-none text-xs"></i>
                </div>
              </div>

              <label
                class="flex items-center justify-between p-3 rounded-xl hover:bg-surface-elevated/50 cursor-pointer border border-transparent hover:border-border/50 transition-all group">
                <div class="flex flex-col">
                  <span
                    class="text-sm font-medium text-text-primary group-hover:text-primary transition-colors">Featured
                    Post</span>
                  <span class="text-xs text-text-tertiary">Pin to top of blog</span>
                </div>
                <input type="checkbox" formControlName="featured" class="toggle toggle-primary toggle-sm" />
              </label>

              <div class="h-px w-full bg-border/50"></div>

              <div class="space-y-1.5">
                <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Author</label>
                <div class="relative">
                  <i class="fa-regular fa-user absolute left-4 top-1/2 -translate-y-1/2 text-text-tertiary"></i>
                  <input type="text" formControlName="author"
                    class="w-full pl-10 pr-4 py-3 bg-surface-elevated/50 border border-border/60 rounded-xl text-text-primary focus:outline-none focus:ring-1 focus:ring-primary/20 focus:border-primary transition-all text-sm" />
                </div>
              </div>
            </div>
          </div>

          <!-- Organization -->
          <div class="glass-panel p-6 rounded-2xl border border-border/50 bg-surface">
            <h3 class="text-xs font-bold text-text-tertiary uppercase tracking-widest mb-6">Organization</h3>

            <div class="space-y-6">
              <!-- Category -->
              <div class="space-y-1.5">
                <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Category</label>
                <div class="relative">
                  <select formControlName="category"
                    class="w-full pl-4 pr-10 py-3 bg-surface-elevated/50 border border-border/60 rounded-xl text-text-primary focus:outline-none focus:ring-1 focus:ring-primary/20 focus:border-primary transition-all appearance-none cursor-pointer text-sm">
                    <option value="" disabled>Select Category</option>
                    <option value="Technology">Technology</option>
                    <option value="Design">Design</option>
                    <option value="Development">Development</option>
                    <option value="Tutorial">Tutorial</option>
                    <option value="Life">Life</option>
                    <option value="Health">Health</option>
                    <option value="Lifestyle">Lifestyle</option>
                  </select>
                  <i
                    class="fa-solid fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-text-tertiary pointer-events-none text-xs"></i>
                </div>
              </div>

              <!-- Tags -->
              <div class="space-y-1.5">
                <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Tags</label>
                <div
                  class="w-full p-2 rounded-xl bg-surface-elevated/50 border border-border/60 focus-within:border-primary focus-within:ring-1 focus-within:ring-primary/20 transition-all flex flex-wrap gap-2 min-h-[50px]">
                  <!-- Tags Loop -->
                  <div *ngFor="let tag of tags.controls; let i = index"
                    class="bg-primary/10 text-primary px-3 py-1 rounded-lg text-sm font-medium flex items-center gap-2 group animate-fade-in">
                    <span>{{ tag.value }}</span>
                    <button type="button" (click)="removeTag(i)"
                      class="text-primary/60 hover:text-primary transition-colors">
                      <i class="fa-solid fa-xmark"></i>
                    </button>
                  </div>
                  <input #tagInput type="text" placeholder="Add tag..." (keyup.enter)="addTag(tagInput.value, tagInput)"
                    class="flex-1 bg-transparent outline-none text-text-primary min-w-[80px] text-sm py-1" />
                </div>
                <p class="text-xs text-text-tertiary ml-1">Press Enter to add tags.</p>
              </div>
            </div>
          </div>

          <!-- Cover Image -->
          <div class="glass-panel p-6 rounded-2xl border border-border/50 bg-surface">
            <h3 class="text-xs font-bold text-text-tertiary uppercase tracking-widest mb-6">Cover Image</h3>

            <div class="flex flex-col gap-4">
              <div
                class="border-2 border-dashed border-border/60 rounded-xl p-6 text-center hover:border-primary/50 hover:bg-surface-elevated/50 transition-all cursor-pointer relative group bg-surface-elevated/20 overflow-hidden min-h-[160px] flex items-center justify-center">
                <input type="file" accept="image/*" (change)="onImageSelected($event)"
                  class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />

                <div class="flex flex-col items-center gap-3 text-text-tertiary relative z-0"
                  *ngIf="!blogForm.get('coverImage')?.value">
                  <div
                    class="w-12 h-12 rounded-full bg-surface-elevated shadow-sm flex items-center justify-center group-hover:text-primary transition-colors">
                    <i class="fa-regular fa-image text-xl"></i>
                  </div>
                  <span class="font-medium text-xs uppercase tracking-wide">Upload Cover</span>
                </div>

                <img *ngIf="blogForm.get('coverImage')?.value" [src]="blogForm.get('coverImage')?.value"
                  class="absolute inset-0 w-full h-full object-cover" />

                <div *ngIf="blogForm.get('coverImage')?.value"
                  class="absolute top-2 right-2 z-20 opacity-0 group-hover:opacity-100 transition-opacity">
                  <button type="button" (click)="$event.stopPropagation(); blogForm.get('coverImage')?.setValue('')"
                    class="btn btn-xs btn-circle btn-error text-white shadow-lg">
                    <i class="fa-solid fa-xmark text-xs"></i>
                  </button>
                </div>
              </div>

              <div class="space-y-1.5">
                <label class="text-[10px] font-bold text-text-tertiary uppercase tracking-wider ml-1">OR ENTER
                  URL</label>
                <input type="text" formControlName="coverImage" placeholder="https://..."
                  class="w-full px-3 py-2 bg-surface-elevated/50 border border-border/60 rounded-lg text-text-primary focus:outline-none focus:ring-1 focus:ring-primary/20 focus:border-primary transition-all text-xs" />
              </div>
            </div>
          </div>

        </div>
      </form>
    </div>
  </div>
</div>