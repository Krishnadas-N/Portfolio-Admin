<div class="container mx-auto p-4 lg:p-8 max-w-5xl" *ngIf="isLoading()">
   <div class="skeleton w-full h-64 rounded-2xl mb-8 bg-base-200"></div>
   <div class="space-y-4">
      <div class="skeleton h-10 w-3/4 bg-base-200"></div>
      <div class="skeleton h-4 w-full bg-base-200"></div>
      <div class="skeleton h-4 w-full bg-base-200"></div>
      <div class="skeleton h-4 w-2/3 bg-base-200"></div>
   </div>
</div>

<div class="container mx-auto p-4 lg:p-8 max-w-5xl" *ngIf="error()">
   <div class="alert alert-error shadow-lg rounded-xl">
      <i class="fa-solid fa-circle-exclamation text-lg"></i>
      <span>{{ error() }}</span>
      <button class="btn btn-sm btn-ghost" routerLink="/blogs">Back to Blogs</button>
   </div>
</div>

<div *ngIf="!isLoading() && !error() && blog()" class="container mx-auto p-4 lg:p-8 max-w-7xl animate-fade-in">

   <!-- Back Button -->
   <div class="mb-6">
      <a routerLink="/blogs"
         class="btn btn-ghost gap-2 pl-0 hover:bg-transparent hover:text-primary transition-colors text-base-content/60">
         <i class="fa-solid fa-arrow-left"></i> Back to Blogs
      </a>
   </div>

   <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12">
      <!-- Main Content -->
      <div class="lg:col-span-2 space-y-8">
         <!-- Hero Image -->
         <div
            class="relative rounded-3xl overflow-hidden aspect-video shadow-lg bg-base-200 group border border-base-200">
            <img [src]="blog()?.featuredImage || 'assets/images/placeholder-blog.jpg'" [alt]="blog()?.title"
               class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" />

            <div class="absolute top-4 left-4 z-10">
               <span
                  class="badge badge-lg border-none shadow-md font-bold uppercase text-xs tracking-wider py-4 px-4 backdrop-blur-md bg-base-100/90 text-base-content">
                  {{ blog()?.category }}
               </span>
            </div>
         </div>

         <!-- Title & Meta -->
         <div>
            <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-base-content leading-tight mb-6 tracking-tight">
               {{ blog()?.title }}
            </h1>

            <div
               class="flex flex-wrap items-center gap-4 text-sm text-base-content/60 border-b border-base-200 pb-8 mb-8">
               <div class="flex items-center gap-3 bg-base-200/50 pr-4 py-1.5 rounded-full pl-1.5">
                  <div class="avatar placeholder">
                     <div class="bg-neutral text-neutral-content rounded-full w-8">
                        <span class="text-xs uppercase">{{ (blog()?.author?.name || 'A').charAt(0) }}</span>
                     </div>
                  </div>
                  <span class="font-medium text-base-content">{{ blog()?.author?.name || 'Admin' }}</span>
               </div>

               <div class="flex items-center gap-2">
                  <i class="fa-regular fa-calendar"></i>
                  <span>{{ blog()?.createdAt | date:'mediumDate' }}</span>
               </div>

               <div class="w-1 h-1 rounded-full bg-base-300"></div>

               <div class="flex items-center gap-2" title="Views">
                  <i class="fa-regular fa-eye"></i>
                  <span>{{ blog()?.viewsCount || 0 }} views</span>
               </div>

               <div class="w-1 h-1 rounded-full bg-base-300"></div>

               <div class="flex items-center gap-2" title="Reading Time" *ngIf="blog()?.readingTime">
                  <i class="fa-regular fa-clock"></i>
                  <span>{{ blog()?.readingTime }} min read</span>
               </div>

               <div class="w-1 h-1 rounded-full bg-base-300"></div>

               <div class="flex items-center gap-2" title="Likes">
                  <i class="fa-regular fa-heart"></i>
                  <span>{{ blog()?.likes || 0 }} likes</span>
               </div>
            </div>

            <!-- Excerpt -->
            <div
               class="mb-10 p-6 bg-base-200/30 border-l-4 border-primary rounded-r-xl italic text-lg text-base-content/80 leading-relaxed"
               *ngIf="blog()?.excerpt">
               {{ blog()?.excerpt }}
            </div>

            <!-- Content -->
            <article
               class="prose prose-lg max-w-none prose-headings:font-bold prose-headings:tracking-tight prose-a:text-primary hover:prose-a:text-primary-focus prose-blockquote:border-l-primary prose-img:rounded-2xl prose-img:shadow-md text-base-content/80"
               [innerHTML]="blog()?.content">
            </article>
         </div>
      </div>

      <!-- Sidebar -->
      <div class="space-y-8 sticky top-24 h-fit">
         <!-- Actions Card -->
         <div class="card bg-base-100 shadow-sm border border-base-200">
            <div class="card-body p-6">
               <h3 class="text-xs font-bold uppercase tracking-wider text-base-content/40 mb-4">Actions</h3>
               <div class="flex flex-col gap-3">
                  <a [routerLink]="['/blogs/edit', blog()?._id]"
                     class="btn btn-primary w-full shadow-lg shadow-primary/20">
                     <i class="fa-solid fa-pen-to-square mr-2"></i> Edit Post
                  </a>
                  <button (click)="deleteBlog()" class="btn btn-outline btn-error w-full hover:bg-error/10">
                     <i class="fa-solid fa-trash-can mr-2"></i> Delete Post
                  </button>
               </div>

               <div class="divider my-6"></div>

               <h3 class="text-xs font-bold uppercase tracking-wider text-base-content/40 mb-4">Status</h3>
               <div class="flex items-center justify-between p-3 bg-base-200/30 rounded-lg mb-2">
                  <span class="font-medium text-sm">Visibility</span>
                  <span class="badge font-bold uppercase text-[10px] py-3 border-none" [ngClass]="{
                        'bg-success/10 text-success': blog()?.status === 'published',
                        'bg-warning/10 text-warning': blog()?.status === 'archived',
                        'bg-base-200 text-base-content/60': blog()?.status === 'draft'
                     }">
                     {{ blog()?.status }}
                  </span>
               </div>
               <div class="flex items-center justify-between p-3 bg-base-200/30 rounded-lg" *ngIf="blog()?.isFeatured">
                  <span class="font-medium text-sm">Featured</span>
                  <span
                     class="badge bg-secondary/10 text-secondary border-none font-bold uppercase text-[10px] py-3">Yes</span>
               </div>

               <div class="divider my-6"></div>

               <h3 class="text-xs font-bold uppercase tracking-wider text-base-content/40 mb-4">Tags</h3>
               <div class="flex flex-wrap gap-2">
                  <span *ngFor="let tag of blog()?.tags"
                     class="badge badge-lg bg-base-200 border-none text-base-content/70 hover:bg-base-300 transition-colors cursor-default">
                     #{{ tag }}
                  </span>
                  <span *ngIf="!blog()?.tags?.length" class="text-sm text-base-content/40 italic">No tags</span>
               </div>
            </div>
         </div>

         <!-- SEO Information -->
         <div class="card bg-base-100 shadow-sm border border-base-200">
            <div class="card-body p-6">
               <h3 class="text-xs font-bold uppercase tracking-wider text-base-content/40 mb-4">SEO Details</h3>
               <div class="space-y-4">
                  <div>
                     <div class="text-xs font-semibold text-base-content/60 mb-1">Meta Title</div>
                     <div class="text-sm font-medium leading-tight">{{ blog()?.seoTitle || '—' }}</div>
                  </div>
                  <div>
                     <div class="text-xs font-semibold text-base-content/60 mb-1">Meta Description</div>
                     <div class="text-sm text-base-content/80 leading-snug">{{ blog()?.seoDescription || '—' }}</div>
                  </div>
               </div>
            </div>
         </div>

         <!-- Related Posts -->
         <div class="card bg-base-100 shadow-sm border border-base-200" *ngIf="relatedPosts().length">
            <div class="card-body p-6">
               <h3 class="text-xs font-bold uppercase tracking-wider text-base-content/40 mb-4">Related Posts</h3>
               <div class="flex flex-col gap-4">
                  <a *ngFor="let post of relatedPosts()" [routerLink]="['/blogs/details', post._id]"
                     class="group flex flex-col gap-1 p-3 rounded-xl hover:bg-base-200/50 transition-colors border border-transparent hover:border-base-200/60">
                     <span class="font-bold text-sm group-hover:text-primary transition-colors line-clamp-2">{{
                        post.title }}</span>
                     <span class="text-xs text-base-content/60 line-clamp-2" *ngIf="post.excerpt">{{ post.excerpt
                        }}</span>
                  </a>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>