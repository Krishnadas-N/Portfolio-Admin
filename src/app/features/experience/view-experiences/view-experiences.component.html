<div class="container mx-auto p-4 lg:p-8 max-w-7xl">
  
  <!-- Header -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8 sticky top-0 z-20 bg-base-100/80 backdrop-blur-md py-4 -mx-4 px-4 sm:mx-0 sm:px-0 border-b border-base-200 sm:border-none">
    <div>
      <h1 class="text-3xl font-bold text-base-content tracking-tight">Experience</h1>
      <p class="text-base-content/60 text-sm mt-1">Manage your professional career history.</p>
    </div>
    
    <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto">
      <div class="join w-full sm:w-auto shadow-sm">
        <div class="relative w-full sm:w-64">
          <input type="text" [(ngModel)]="searchTerm" (keyup.enter)="onSearch()" 
                 placeholder="Search experiences..." 
                 class="input input-bordered join-item w-full pl-10 focus:input-primary transition-all bg-base-100 placeholder:text-base-content/40" />
          <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-base-content/40"></i>
        </div>
        <button (click)="onSearch()" class="btn btn-primary join-item px-6">Search</button>
      </div>
      
      <a routerLink="/experience/add" class="btn btn-primary shadow-lg shadow-primary/20 shrink-0 gap-2">
        <i class="fa-solid fa-briefcase"></i> Add New
      </a>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading()" class="space-y-6">
    <div *ngFor="let i of [1,2,3]" class="card bg-base-100 shadow-sm border border-base-200 p-6 animate-pulse">
      <div class="flex gap-4">
        <div class="h-16 w-16 bg-base-200 rounded-xl"></div>
        <div class="flex-1 space-y-2">
          <div class="h-6 bg-base-200 w-1/3 rounded"></div>
          <div class="h-4 bg-base-200 w-1/4 rounded"></div>
          <div class="h-4 bg-base-200 w-1/2 rounded"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading() && !error() && experiences().length === 0" class="flex flex-col items-center justify-center py-24 bg-base-100 rounded-3xl border-2 border-dashed border-base-200 text-center">
    <div class="w-24 h-24 bg-base-200/50 rounded-full flex items-center justify-center mb-6 text-base-content/20">
      <i class="fa-solid fa-building text-4xl"></i>
    </div>
    <h3 class="text-xl font-bold text-base-content">No experience added</h3>
    <p class="text-base-content/60 max-w-xs mt-2 mb-8">Add your work experience to build your professional timeline.</p>
    <a routerLink="/experience/add" class="btn btn-primary">Add Experience</a>
  </div>

  <!-- Experiences List -->
  <div *ngIf="!isLoading() && experiences().length > 0" class="space-y-6">
    <div *ngFor="let exp of experiences()" class="card bg-base-100 shadow-sm hover:shadow-xl transition-all duration-300 border border-base-200/60 group relative overflow-hidden">
      <div class="card-body p-6 sm:p-8">
        <div class="flex flex-col sm:flex-row gap-6">
          
          <!-- Logo -->
          <div class="w-16 h-16 rounded-xl bg-base-200/50 border border-base-200 p-2 shrink-0 flex items-center justify-center overflow-hidden">
             <img [src]="exp.logo || 'assets/images/placeholder-company.png'" [alt]="exp.company" class="w-full h-full object-contain" />
          </div>

          <!-- Content -->
          <div class="flex-1 min-w-0 space-y-3">
            <div class="flex flex-col md:flex-row md:items-start justify-between gap-4">
              <div>
                <h2 class="text-xl font-bold text-base-content leading-tight">{{ exp.position }}</h2>
                <div class="flex flex-wrap items-center gap-2 mt-1">
                   <span class="text-base font-medium text-primary">{{ exp.company }}</span>
                   <span class="text-base-content/40">â€¢</span>
                   <span class="text-sm text-base-content/70">{{ exp.employmentType || 'Full-time' }}</span>
                </div>
              </div>
              
              <div class="flex flex-col md:items-end gap-1 text-sm shrink-0">
                 <div class="font-medium text-base-content/80">
                    {{ exp.startDate | date:'MMM y' }} - {{ exp.isCurrent ? 'Present' : (exp.endDate | date:'MMM y') }}
                 </div>
                 <div class="text-base-content/50 text-xs">
                    {{ calculateDuration(exp.startDate, exp.endDate, exp.isCurrent) }}
                 </div>
                 <div class="flex items-center gap-1 text-xs text-base-content/50 mt-1" *ngIf="exp.location">
                    <i class="fa-solid fa-location-dot"></i> {{ exp.location }}
                 </div>
              </div>
            </div>

            <!-- Description -->
            <p class="text-sm text-base-content/70 leading-relaxed whitespace-pre-line" *ngIf="exp.description">
               {{ exp.description }}
            </p>

            <!-- Skills -->
            <div class="flex flex-wrap gap-2 mt-4 pt-4 border-t border-base-200/50" *ngIf="exp.skills?.length">
               <span *ngFor="let skill of exp.skills" class="badge badge-sm bg-base-200 border-base-200 text-base-content/70">
                  {{ skill }}
               </span>
            </div>
          </div>

          <!-- Actions -->
          <div class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex gap-2">
             <a [routerLink]="['/experience/edit', exp._id]" class="btn btn-sm btn-square btn-ghost hover:bg-base-200" title="Edit">
                <i class="fa-solid fa-pen-to-square"></i>
             </a>
             <button (click)="deleteExperience(exp._id!)" class="btn btn-sm btn-square btn-ghost text-error hover:bg-error/10" title="Delete">
                <i class="fa-regular fa-trash-can"></i>
             </button>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="!isLoading() && pagination()" class="mt-10 pt-6">
    <app-pagination [pagination]="pagination()!" (pageChange)="onPageChange($event)"></app-pagination>
  </div>
</div>
