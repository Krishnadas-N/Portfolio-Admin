<div class="container mx-auto p-4 lg:p-8 max-w-7xl">
  
  <!-- Header Actions -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8 sticky top-0 z-20 bg-base-100/80 backdrop-blur-md py-4 -mx-4 px-4 sm:mx-0 sm:px-0 border-b border-base-200 sm:border-none">
    <div>
      <h1 class="text-3xl font-bold text-base-content tracking-tight">{{ isEditMode() ? 'Edit Certification' : 'New Certification' }}</h1>
      <p class="text-base-content/60 text-sm mt-1">Add details about your professional certification.</p>
    </div>
    <div class="flex gap-3 w-full sm:w-auto">
      <button type="button" (click)="onCancel()" class="btn btn-ghost flex-1 sm:flex-none">Cancel</button>
      <button type="button" (click)="onSubmit()" [disabled]="certificationForm.invalid || isSubmitting()" class="btn btn-primary flex-1 sm:flex-none shadow-lg shadow-primary/20">
        <span *ngIf="isSubmitting()" class="loading loading-spinner loading-xs"></span>
        <i class="fa-regular fa-floppy-disk mr-2" *ngIf="!isSubmitting()"></i>
        {{ isEditMode() ? 'Save Changes' : 'Add Certification' }}
      </button>
    </div>
  </div>

  <form [formGroup]="certificationForm" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    
    <!-- Left Column (Main Content) -->
    <div class="lg:col-span-2 space-y-8">
      
      <!-- Basic Info -->
      <div class="card bg-base-100 shadow-sm border border-base-200">
        <div class="card-body p-6">
          <h2 class="card-title text-lg flex items-center gap-2 mb-4">
            <div class="w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
              <i class="fa-solid fa-certificate"></i>
            </div>
            Certification Details
          </h2>
          
          <div class="space-y-4">
            <div class="form-control">
              <label class="label"><span class="label-text font-medium">Certification Name</span></label>
              <input type="text" formControlName="name" placeholder="e.g. AWS Certified Solutions Architect" 
                     class="input input-bordered w-full focus:input-primary transition-all" 
                     [class.input-error]="f['name'].touched && f['name'].invalid" />
              <label class="label" *ngIf="f['name'].touched && f['name'].invalid">
                <span class="label-text-alt text-error">Name is required</span>
              </label>
            </div>

            <div class="form-control">
              <label class="label"><span class="label-text font-medium">Issuing Organization</span></label>
              <input type="text" formControlName="issuer" placeholder="e.g. Amazon Web Services" 
                     class="input input-bordered w-full focus:input-primary transition-all"
                     [class.input-error]="f['issuer'].touched && f['issuer'].invalid" />
              <label class="label" *ngIf="f['issuer'].touched && f['issuer'].invalid">
                <span class="label-text-alt text-error">Issuer is required</span>
              </label>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
               <div class="form-control">
                 <label class="label"><span class="label-text font-medium">Issue Date</span></label>
                 <input type="date" formControlName="issueDate" class="input input-bordered w-full" 
                        [class.input-error]="f['issueDate'].touched && f['issueDate'].invalid" />
               </div>
               <div class="form-control">
                 <label class="label"><span class="label-text font-medium">Expiry Date (Optional)</span></label>
                 <input type="date" formControlName="expiryDate" class="input input-bordered w-full" />
               </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
               <div class="form-control">
                 <label class="label"><span class="label-text font-medium">Category</span></label>
                 <input type="text" formControlName="category" placeholder="e.g. Cloud Computing" class="input input-bordered w-full" />
               </div>
               <div class="form-control">
                 <label class="label"><span class="label-text font-medium">Level</span></label>
                 <select formControlName="level" class="select select-bordered w-full">
                    <option value="beginner">Beginner</option>
                    <option value="intermediate">Intermediate</option>
                    <option value="advanced">Advanced</option>
                    <option value="expert">Expert</option>
                 </select>
               </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Skills -->
      <div class="card bg-base-100 shadow-sm border border-base-200">
        <div class="card-body p-6">
          <h2 class="card-title text-lg flex items-center gap-2 mb-4">
            <div class="w-8 h-8 rounded-lg bg-secondary/10 flex items-center justify-center text-secondary">
              <i class="fa-solid fa-lightbulb"></i>
            </div>
            Skills Validated
          </h2>

          <div class="form-control">
             <label class="label"><span class="label-text font-medium">Add Skills</span></label>
             <div class="relative">
                <input #skillInput type="text" placeholder="Type skill and press Enter..." 
                       class="input input-bordered w-full pr-12"
                       (keyup.enter)="addSkill(skillInput.value, skillInput)" />
                <button type="button" class="absolute right-2 top-1/2 -translate-y-1/2 btn btn-xs btn-ghost btn-square" 
                        (click)="addSkill(skillInput.value, skillInput)">
                  <i class="fa-solid fa-plus"></i>
                </button>
             </div>
             <div class="flex flex-wrap gap-2 mt-3 min-h-[2rem]">
                <div *ngFor="let skill of skills.controls; let i = index" 
                     class="badge badge-lg gap-2 pl-3 pr-1 py-3 bg-base-200 border-base-300">
                  {{ skill.value }}
                  <button type="button" (click)="removeSkill(i)" 
                          class="btn btn-circle btn-ghost btn-xs w-5 h-5 min-h-0 text-base-content/50 hover:text-error">
                    <i class="fa-solid fa-xmark text-[10px]"></i>
                  </button>
                </div>
                <span *ngIf="skills.length === 0" class="text-sm text-base-content/40 italic py-1">No skills added yet</span>
             </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Right Column (Sidebar) -->
    <div class="space-y-8">
      
      <!-- Credential Verification -->
      <div class="card bg-base-100 shadow-sm border border-base-200">
        <div class="card-body p-6">
          <h2 class="card-title text-base mb-4 text-base-content/70 uppercase tracking-wide font-bold text-xs">Verification</h2>
          
          <div class="space-y-4">
            <div class="form-control">
              <label class="label"><span class="label-text font-medium">Credential ID</span></label>
              <input type="text" formControlName="credentialId" placeholder="ID or License Number" class="input input-bordered w-full text-sm" />
            </div>

            <div class="form-control">
              <label class="label flex justify-between">
                <span class="label-text font-medium">Credential URL</span>
                <i class="fa-solid fa-link text-base-content/40"></i>
              </label>
              <input type="url" formControlName="credentialUrl" placeholder="https://..." class="input input-bordered w-full text-sm" />
            </div>
          </div>
        </div>
      </div>

      <!-- Badge/Logo Image -->
      <div class="card bg-base-100 shadow-sm border border-base-200">
        <div class="card-body p-6">
          <h2 class="card-title text-base mb-4 text-base-content/70 uppercase tracking-wide font-bold text-xs">Badge / Logo</h2>
          
          <div class="form-control">
             <div class="border-2 border-dashed border-base-300 rounded-xl p-6 text-center hover:border-primary/50 hover:bg-base-200/30 transition-all cursor-pointer relative group bg-base-50/50 flex flex-col items-center justify-center min-h-[160px]">
                <input type="file" accept="image/*" (change)="onImageSelected($event)" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />
                
                <div class="flex flex-col items-center gap-2 text-base-content/60" *ngIf="!certificationForm.get('image')?.value">
                   <div class="w-12 h-12 rounded-full bg-base-200 flex items-center justify-center mb-1 group-hover:bg-primary/10 group-hover:text-primary transition-colors">
                      <i class="fa-solid fa-award text-xl"></i>
                   </div>
                   <span class="font-medium text-sm">Upload Badge</span>
                </div>
                
                <div *ngIf="certificationForm.get('image')?.value" class="relative w-24 h-24">
                   <img [src]="certificationForm.get('image')?.value" class="w-full h-full object-contain" />
                   <button type="button" (click)="$event.stopPropagation(); certificationForm.get('image')?.setValue('')" 
                           class="absolute -top-2 -right-2 z-20 btn btn-circle btn-xs btn-error text-white shadow-lg opacity-0 group-hover:opacity-100 transition-opacity">
                      <i class="fa-solid fa-xmark"></i>
                   </button>
                </div>
             </div>
             <div class="divider text-xs text-base-content/30 my-4 font-medium">OR URL</div>
             <input type="text" formControlName="image" placeholder="https://..." class="input input-sm input-bordered w-full" />
          </div>
        </div>
      </div>

      <!-- Visibility -->
      <div class="card bg-base-100 shadow-sm border border-base-200">
        <div class="card-body p-6">
          <h2 class="card-title text-base mb-4 text-base-content/70 uppercase tracking-wide font-bold text-xs">Visibility</h2>
          
          <div class="form-control">
            <label class="label cursor-pointer p-0 hover:bg-base-200 rounded-lg p-2 -mx-2 transition-colors">
              <div class="flex flex-col">
                <span class="label-text font-medium">Active</span>
                <span class="label-text-alt text-base-content/50">Show on portfolio</span>
              </div>
              <input type="checkbox" formControlName="isActive" class="toggle toggle-success toggle-sm" />
            </label>
          </div>
        </div>
      </div>

    </div>
  </form>
</div>
