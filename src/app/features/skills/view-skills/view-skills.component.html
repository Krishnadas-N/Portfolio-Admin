<div class="h-full flex flex-col p-6 max-w-[1920px] mx-auto w-full overflow-hidden">

  <!-- Header Section -->
  <div class="flex flex-col md:flex-row justify-between items-end md:items-center gap-4 mb-4 shrink-0">
    <div>
      <h1 class="text-3xl font-bold text-text-primary tracking-tight">Skills & Expertise</h1>
      <p class="text-text-secondary text-sm mt-1">Manage your technical skills inventory.</p>
    </div>

    <!-- Actions -->
    <div class="flex items-center gap-3">
      <!-- Search -->
      <div class="relative w-64 hidden sm:block">
        <i class="fa-solid fa-magnifying-glass absolute left-3.5 top-1/2 -translate-y-1/2 text-text-tertiary"></i>
        <input type="text" [ngModel]="searchTerm()" (ngModelChange)="searchTerm.set($event)"
          placeholder="Filter skills..."
          class="w-full pl-10 pr-4 py-2.5 bg-surface border border-border rounded-xl text-sm text-text-primary placeholder:text-text-tertiary focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all shadow-sm" />
      </div>

      <a routerLink="/skills/add"
        class="px-5 py-2.5 rounded-xl bg-primary text-white hover:bg-primary-hover shadow-lg shadow-primary/25 hover:shadow-primary/40 transition-all text-sm font-medium flex items-center justify-center gap-2 transform active:scale-95 shrink-0">
        <i class="fa-solid fa-plus"></i>
        <span>Add Skill</span>
      </a>
    </div>
  </div>

  <!-- Mobile Search (Visible only on small screens) -->
  <div class="sm:hidden mb-6 shrink-0 relative">
    <i class="fa-solid fa-magnifying-glass absolute left-3.5 top-1/2 -translate-y-1/2 text-text-tertiary"></i>
    <input type="text" [ngModel]="searchTerm()" (ngModelChange)="searchTerm.set($event)" placeholder="Search..."
      class="w-full pl-10 pr-4 py-3 bg-surface border border-border rounded-xl text-sm focus:outline-none focus:border-primary shadow-sm" />
  </div>

  <!-- Filter Tabs -->
  <div class="mb-6 shrink-0 overflow-x-auto pb-1 -mx-6 px-6 sm:mx-0 sm:px-0 scrollbar-hide">
    <div class="flex gap-2">
      <button *ngFor="let cat of categories()" (click)="setTab(cat)"
        class="px-4 py-2 rounded-lg text-sm font-semibold whitespace-nowrap transition-all duration-200 border"
        [ngClass]="{
                 'bg-primary text-white border-primary shadow-md shadow-primary/20': activeTab() === cat,
                 'bg-surface hover:bg-surface-elevated text-text-secondary border-border hover:border-border/80': activeTab() !== cat
              }">
        {{ cat }}
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading()" class="space-y-6">
    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4">
      <div *ngFor="let i of [1,2,3,4,5,6,7,8,9,10]" class="h-40 bg-surface-elevated/50 rounded-2xl animate-pulse"></div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading() && !error() && filteredSkills().length === 0"
    class="flex-1 flex flex-col items-center justify-center glass-panel rounded-3xl border border-dashed border-border text-center m-4">
    <div class="w-24 h-24 bg-surface-elevated/50 rounded-full flex items-center justify-center mb-6 text-text-tertiary">
      <i *ngIf="searchTerm()" class="fa-solid fa-filter text-4xl opacity-50"></i>
      <i *ngIf="!searchTerm()" class="fa-solid fa-code text-4xl opacity-50"></i>
    </div>
    <h3 class="text-xl font-bold text-text-primary">
      {{ searchTerm() ? 'No matching skills found' : 'No skills found' }}
    </h3>
    <p class="text-text-tertiary max-w-xs mt-2 mb-8">
      {{ searchTerm() ? 'Try adjusting your search criteria.' : 'Add your first skill to get started.' }}
    </p>
    <a *ngIf="!searchTerm()" routerLink="/skills/add"
      class="px-5 py-2.5 rounded-xl bg-primary text-white hover:bg-primary-hover shadow-lg shadow-primary/20 text-sm font-medium transition-colors">Add
      Skill</a>
    <button *ngIf="searchTerm()" (click)="searchTerm.set('')" class="text-primary font-medium hover:underline">Clear
      Search</button>
  </div>

  <!-- Skills Grid (Scrollable) -->
  <div *ngIf="!isLoading() && filteredSkills().length > 0"
    class="flex-1 overflow-y-auto custom-scrollbar min-h-0 pb-10">
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 2xl:grid-cols-6 gap-4 sm:gap-6">

      <div *ngFor="let skill of filteredSkills()"
        class="group relative bg-surface hover:bg-surface-elevated border border-border/50 hover:border-primary/30 rounded-2xl p-5 flex flex-col items-center text-center transition-all duration-300 hover:shadow-xl hover:shadow-primary/5 hover:-translate-y-1">

        <!-- Status Dot (if inactive) -->
        <div *ngIf="!skill.isActive"
          class="absolute top-3 left-3 w-2 h-2 rounded-full bg-amber-500 ring-2 ring-surface z-10" title="Inactive">
        </div>

        <!-- Actions Menu (Floating) -->
        <div
          class="flex gap-1 absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-20">
          <a [routerLink]="['/skills/edit', skill._id]"
            class="w-7 h-7 flex items-center justify-center rounded-lg bg-surface-elevated/80 text-text-secondary hover:text-primary backdrop-blur hover:bg-surface-elevated shadow-sm transition-colors"
            title="Edit">
            <i class="fa-solid fa-pen text-[10px]"></i>
          </a>
          <button (click)="deleteSkill(skill)"
            class="w-7 h-7 flex items-center justify-center rounded-lg bg-surface-elevated/80 text-text-secondary hover:text-red-500 backdrop-blur hover:bg-surface-elevated shadow-sm transition-colors"
            title="Delete">
            <i class="fa-regular fa-trash-can text-[10px]"></i>
          </button>
        </div>

        <!-- Icon -->
        <div
          class="w-16 h-16 mb-4 rounded-2xl bg-surface-elevated p-3.5 flex items-center justify-center shadow-inner group-hover:scale-110 transition-transform duration-300 relative overflow-hidden ring-1 ring-border/50">
          <!-- Proficiency Ring Background -->
          <svg class="absolute inset-0 w-full h-full -rotate-90 pointer-events-none opacity-20" viewBox="0 0 36 36">
            <path class="text-border" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
              fill="none" stroke="currentColor" stroke-width="2" />
            <path [attr.stroke-dasharray]="skill.proficiency + ', 100'"
              class="text-primary transition-all duration-1000 ease-out"
              d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none"
              stroke="currentColor" stroke-width="2" />
          </svg>

          <img [src]="skill.icon || defaultLogo" [alt]="skill.name"
            class="w-full h-full object-contain relative z-10 mix-blend-multiply dark:mix-blend-normal" />
        </div>

        <!-- Text Content -->
        <h3
          class="font-bold text-text-primary text-base leading-tight mb-1 truncate w-full group-hover:text-primary transition-colors">
          {{ skill.name }}</h3>

        <!-- Level Badge -->
        <span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider gap-1"
          [ngClass]="{
                      'bg-emerald-500/10 text-emerald-600': skill.level === 'expert',
                      'bg-blue-500/10 text-blue-600': skill.level === 'advanced',
                      'bg-amber-500/10 text-amber-600': skill.level === 'intermediate',
                      'bg-slate-500/10 text-slate-500': skill.level === 'beginner'
                   }">
          {{ skill.level }}
        </span>

        <!-- Proficiency text -->
        <div
          class="text-[10px] font-mono text-text-tertiary mt-2 opacity-60 group-hover:opacity-100 transition-opacity">
          {{ skill.proficiency }}% Proficiency
        </div>

      </div>

      <!-- Add New Card (Quick Access) -->
      <a routerLink="/skills/add"
        class="group bg-surface/30 border border-dashed border-border/60 hover:border-primary/50 rounded-2xl p-5 flex flex-col items-center justify-center text-center transition-all duration-300 hover:bg-primary/5 cursor-pointer min-h-[200px]">
        <div
          class="w-12 h-12 rounded-full bg-surface-elevated flex items-center justify-center mb-3 group-hover:bg-primary group-hover:text-white transition-colors text-text-tertiary">
          <i class="fa-solid fa-plus text-lg"></i>
        </div>
        <span class="text-sm font-semibold text-text-secondary group-hover:text-primary">Add New Skill</span>
      </a>

    </div>
  </div>
</div>