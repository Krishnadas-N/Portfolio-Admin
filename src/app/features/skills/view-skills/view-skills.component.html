<div class="container mx-auto p-4 lg:p-8 max-w-7xl">
  
  <!-- Header -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8 sticky top-0 z-20 bg-base-100/80 backdrop-blur-md py-4 -mx-4 px-4 sm:mx-0 sm:px-0 border-b border-base-200 sm:border-none">
    <div>
      <h1 class="text-3xl font-bold text-base-content tracking-tight">Skills & Expertise</h1>
      <p class="text-base-content/60 text-sm mt-1">Manage your technical skills and proficiency levels.</p>
    </div>
    <a routerLink="/skills/add" class="btn btn-primary shadow-lg shadow-primary/20 gap-2">
      <i class="fa-solid fa-plus"></i> Add Skill
    </a>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading()" class="space-y-8">
    <div *ngFor="let i of [1,2]" class="card bg-base-100 border border-base-200 shadow-sm p-6">
      <div class="h-8 w-48 bg-base-200 rounded mb-6 animate-pulse"></div>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <div *ngFor="let j of [1,2,3]" class="h-32 bg-base-200 rounded-xl animate-pulse"></div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading() && groupedSkills().length === 0" class="flex flex-col items-center justify-center py-24 bg-base-100 rounded-3xl border-2 border-dashed border-base-200 text-center">
    <div class="w-24 h-24 bg-base-200/50 rounded-full flex items-center justify-center mb-6 text-base-content/20">
      <i class="fa-solid fa-code text-4xl"></i>
    </div>
    <h3 class="text-xl font-bold text-base-content">No skills found</h3>
    <p class="text-base-content/60 max-w-xs mt-2 mb-8">Start adding your skills to showcase your expertise.</p>
    <a routerLink="/skills/add" class="btn btn-primary">Add First Skill</a>
  </div>

  <!-- Skills Categories -->
  <div *ngIf="!isLoading() && groupedSkills().length > 0" class="space-y-8">
    <div *ngFor="let category of groupedSkills()" class="card bg-base-100 border border-base-200 shadow-sm">
      <div class="card-body p-6">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
            <i class="fa-solid fa-layer-group"></i>
          </div>
          <h2 class="text-xl font-bold text-base-content">{{ category.name }}</h2>
          <span class="badge badge-ghost">{{ category.skills.length }}</span>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
          <div *ngFor="let skill of category.skills" class="group relative bg-base-50 hover:bg-base-100 border border-base-200 rounded-xl p-4 transition-all duration-300 hover:shadow-md hover:-translate-y-1">
            
            <!-- Actions Menu -->
            <div class="absolute top-2 right-2 z-10">
              <button (click)="toggleMenu(skill)" class="btn btn-ghost btn-circle btn-xs h-6 w-6 min-h-0 text-base-content/40 hover:text-base-content hover:bg-base-200">
                <i class="fa-solid fa-ellipsis-vertical"></i>
              </button>
              
              <div *ngIf="skill.showMenu" class="absolute right-0 top-8 w-32 bg-base-100 rounded-lg shadow-xl border border-base-200 py-1 overflow-hidden z-20 animate-in fade-in zoom-in-95 duration-200">
                <a [routerLink]="['/skills/edit', skill._id]" class="block px-4 py-2 text-sm hover:bg-base-200 text-base-content transition-colors">
                  <i class="fa-solid fa-pen-to-square w-4 mr-2 opacity-70"></i> Edit
                </a>
                <button (click)="deleteSkill(skill)" class="block w-full text-left px-4 py-2 text-sm hover:bg-error/10 text-error transition-colors">
                  <i class="fa-solid fa-trash-can w-4 mr-2 opacity-70"></i> Delete
                </button>
              </div>
              
              <!-- Backdrop to close menu -->
              <div *ngIf="skill.showMenu" (click)="skill.showMenu = false" class="fixed inset-0 z-0 cursor-default"></div>
            </div>

            <div class="flex items-center gap-4">
              <!-- Icon/Logo -->
              <div class="w-12 h-12 rounded-lg bg-white p-2 border border-base-200 flex items-center justify-center shrink-0 shadow-sm group-hover:scale-110 transition-transform duration-300"
                   [style.border-color]="skill.color" [style.background-color]="skill.color ? skill.color + '10' : 'white'">
                <img [src]="skill.icon || defaultLogo" [alt]="skill.name" class="w-full h-full object-contain" />
              </div>
              
              <div class="flex-1 min-w-0">
                <h3 class="font-bold text-base-content truncate group-hover:text-primary transition-colors">{{ skill.name }}</h3>
                <div class="flex items-center gap-2 mt-1">
                  <div class="badge badge-xs font-medium px-2 py-2" 
                       [ngClass]="{
                         'badge-success/10 text-success border-success/20': skill.level === 'expert',
                         'badge-info/10 text-info border-info/20': skill.level === 'advanced',
                         'badge-warning/10 text-warning border-warning/20': skill.level === 'intermediate',
                         'badge-neutral/10 text-neutral border-neutral/20': skill.level === 'beginner'
                       }">
                    {{ skill.level | titlecase }}
                  </div>
                  <span *ngIf="skill.yearsOfExperience" class="text-[10px] text-base-content/40 font-mono">{{ skill.yearsOfExperience }} yrs</span>
                </div>
              </div>
            </div>

            <p *ngIf="skill.description" class="mt-3 text-xs text-base-content/60 line-clamp-2" [title]="skill.description">
              {{ skill.description }}
            </p>
            
            <div *ngIf="!skill.isActive" class="absolute top-2 left-2 z-10">
               <span class="badge badge-warning badge-xs">Inactive</span>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>
