<div class="h-full flex flex-col p-6 max-w-[1920px] mx-auto w-full overflow-hidden">

  <!-- Header Section -->
  <div class="flex flex-col sm:flex-row justify-between items-end sm:items-center gap-4 mb-8 shrink-0">
    <div>
      <h1 class="text-3xl font-bold text-text-primary tracking-tight">{{ isEditMode() ? 'Edit Skill' : 'Add New Skill'
        }}</h1>
      <p class="text-text-secondary text-sm mt-1">Define your technical expertise.</p>
    </div>

    <div class="flex gap-3 w-full sm:w-auto">
      <button type="button" (click)="onCancel()"
        class="px-5 py-2.5 rounded-xl border border-border text-text-secondary hover:bg-surface-elevated hover:text-text-primary transition-all text-sm font-medium">Cancel</button>
      <button type="button" (click)="onSubmit()" [disabled]="skillForm.invalid || isSubmitting()"
        class="px-5 py-2.5 rounded-xl bg-primary text-white hover:bg-primary-hover shadow-lg shadow-primary/25 hover:shadow-primary/40 transition-all text-sm font-medium flex items-center justify-center gap-2 transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
        <span *ngIf="isSubmitting()" class="loading loading-spinner loading-xs"></span>
        <i class="fa-regular fa-floppy-disk" *ngIf="!isSubmitting()"></i>
        <span>{{ isEditMode() ? 'Save Changes' : 'Add Skill' }}</span>
      </button>
    </div>
  </div>

  <!-- Main Scrollable Content -->
  <div class="flex-1 overflow-y-auto custom-scrollbar min-h-0 pb-10">
    <div class="max-w-5xl mx-auto">
      <form [formGroup]="skillForm" class="grid grid-cols-1 md:grid-cols-3 gap-8">

        <!-- Left Column: Main form -->
        <div class="md:col-span-2 space-y-8">

          <!-- Skill Details Card -->
          <div class="glass-panel p-6 sm:p-8 rounded-2xl border border-border/50 bg-surface">
            <div class="flex items-center gap-3 mb-6">
              <div
                class="w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary border border-primary/10 shadow-sm">
                <i class="fa-solid fa-code text-lg"></i>
              </div>
              <h2 class="text-lg font-bold text-text-primary">Skill Details</h2>
            </div>

            <div class="grid grid-cols-1 gap-6">

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <!-- Name -->
                <div class="space-y-1.5">
                  <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Skill
                    Name</label>
                  <input type="text" formControlName="name" placeholder="e.g. Angular"
                    class="w-full px-4 py-3 rounded-xl bg-surface-elevated/50 border border-border/60 focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none text-text-primary placeholder:text-text-tertiary transition-all"
                    [class.border-red-500]="f['name'].touched && f['name'].invalid" />
                  <span class="text-red-500 text-xs ml-1" *ngIf="f['name'].touched && f['name'].invalid">Name is
                    required</span>
                </div>

                <!-- Category -->
                <div class="space-y-1.5">
                  <label
                    class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Category</label>
                  <input type="text" formControlName="category" placeholder="e.g. Framework"
                    class="w-full px-4 py-3 rounded-xl bg-surface-elevated/50 border border-border/60 focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none text-text-primary placeholder:text-text-tertiary transition-all"
                    [class.border-red-500]="f['category'].touched && f['category'].invalid" />
                  <span class="text-red-500 text-xs ml-1"
                    *ngIf="f['category'].touched && f['category'].invalid">Category is required</span>
                </div>
              </div>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <!-- Level -->
                <div class="space-y-1.5">
                  <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Proficiency
                    Level</label>
                  <div class="relative">
                    <select formControlName="level"
                      class="w-full pl-4 pr-10 py-3 rounded-xl bg-surface-elevated/50 border border-border/60 focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none text-text-primary appearance-none cursor-pointer transition-all">
                      <option value="beginner">Beginner</option>
                      <option value="intermediate">Intermediate</option>
                      <option value="advanced">Advanced</option>
                      <option value="expert">Expert</option>
                    </select>
                    <i
                      class="fa-solid fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-text-tertiary pointer-events-none text-xs"></i>
                  </div>
                </div>

                <!-- Years -->
                <div class="space-y-1.5">
                  <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Years of
                    Experience</label>
                  <input type="number" formControlName="yearsOfExperience" min="0" placeholder="0"
                    class="w-full px-4 py-3 rounded-xl bg-surface-elevated/50 border border-border/60 focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none text-text-primary placeholder:text-text-tertiary transition-all" />
                </div>
              </div>

              <!-- Description -->
              <div class="space-y-1.5">
                <label
                  class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Description</label>
                <textarea formControlName="description"
                  class="w-full px-4 py-3 rounded-xl bg-surface-elevated/50 border border-border/60 focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none text-text-primary placeholder:text-text-tertiary transition-all min-h-[100px] resize-y"
                  placeholder="Brief description..."></textarea>
              </div>

            </div>
          </div>

        </div>

        <!-- Right Column: Sidebar -->
        <div class="space-y-6">

          <!-- Icon Card -->
          <div class="glass-panel p-6 rounded-2xl border border-border/50 bg-surface">
            <h2 class="text-xs font-bold text-text-tertiary uppercase tracking-widest mb-4">Icon & Branding</h2>

            <div class="space-y-5">

              <!-- Logo Upload -->
              <div class="space-y-1.5">
                <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Skill
                  Icon</label>
                <div
                  class="relative w-full aspect-square md:h-40 rounded-xl border-2 border-dashed border-border hover:border-primary/50 hover:bg-surface-elevated/50 transition-all flex flex-col items-center justify-center p-4 group cursor-pointer bg-surface-elevated/20 overflow-hidden"
                  [style.border-color]="skillForm.get('color')?.value + '40'">

                  <input type="file" accept="image/*" (change)="onImageSelected($event)"
                    class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />

                  <!-- Placeholder -->
                  <div
                    class="flex flex-col items-center gap-3 text-text-tertiary group-hover:text-primary transition-colors"
                    *ngIf="!skillForm.get('icon')?.value">
                    <div class="w-12 h-12 rounded-full bg-surface-elevated flex items-center justify-center shadow-sm"
                      [style.color]="skillForm.get('color')?.value">
                      <i class="fa-regular fa-image text-xl opacity-80"></i>
                    </div>
                    <span class="text-xs font-semibold uppercase tracking-wide">Upload Icon</span>
                  </div>

                  <!-- Preview -->
                  <div *ngIf="skillForm.get('icon')?.value"
                    class="w-full h-full p-4 flex items-center justify-center relative">
                    <div class="absolute inset-0 opacity-10" [style.background-color]="skillForm.get('color')?.value">
                    </div>
                    <img [src]="skillForm.get('icon')?.value"
                      class="max-w-full max-h-full object-contain drop-shadow-sm relative z-10" />
                    <button type="button" (click)="$event.stopPropagation(); skillForm.get('icon')?.setValue('')"
                      class="absolute top-2 right-2 btn btn-circle btn-xs btn-error text-white shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-20">
                      <i class="fa-solid fa-xmark"></i>
                    </button>
                  </div>
                </div>

                <!-- URL Input -->
                <div class="space-y-1.5 mt-2">
                  <label class="text-[10px] font-bold text-text-tertiary uppercase tracking-wider ml-1">OR ENTER
                    URL</label>
                  <input type="text" formControlName="icon" placeholder="https://..."
                    class="w-full px-3 py-2 rounded-lg bg-surface-elevated/50 border border-border/60 text-xs text-text-primary focus:border-primary outline-none" />
                </div>
              </div>

              <!-- Color Picker -->
              <div class="space-y-1.5">
                <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Brand
                  Color</label>
                <div class="flex gap-2 items-center p-2 rounded-xl border border-border/60 bg-surface-elevated/30">
                  <input type="color" formControlName="color"
                    class="w-10 h-10 p-0 border-0 rounded-lg cursor-pointer bg-transparent shadow-sm" />
                  <input type="text" formControlName="color"
                    class="flex-1 bg-transparent border-none text-sm font-mono text-text-primary uppercase focus:ring-0" />
                </div>
              </div>

            </div>
          </div>

          <!-- Settings Card -->
          <div class="glass-panel p-6 rounded-2xl border border-border/50 bg-surface">
            <h2 class="text-xs font-bold text-text-tertiary uppercase tracking-widest mb-4">Display Settings</h2>

            <div class="form-control">
              <label
                class="flex items-center gap-3 p-3 rounded-xl bg-surface-elevated/30 border border-border/30 cursor-pointer hover:bg-surface-elevated/50 transition-colors">
                <input type="checkbox" formControlName="isActive" class="checkbox checkbox-success checkbox-sm" />
                <div class="flex flex-col">
                  <span class="text-sm font-semibold text-text-primary">Active Status</span>
                  <span class="text-xs text-text-tertiary">Visible on public portfolio</span>
                </div>
              </label>
            </div>
          </div>

        </div>

      </form>
    </div>
  </div>
</div>