<div class="h-full flex flex-col p-6 max-w-[1920px] mx-auto w-full overflow-hidden">

  <!-- Header Section -->
  <div class="flex flex-col sm:flex-row justify-between items-end sm:items-center gap-4 mb-8 shrink-0">
    <div>
      <h1 class="text-3xl font-bold text-text-primary tracking-tight">{{ isEditMode() ? 'Edit Education' : 'Add
        Education' }}</h1>
      <p class="text-text-secondary text-sm mt-1">Manage your academic background and qualifications.</p>
    </div>

    <div class="flex gap-3 w-full sm:w-auto">
      <button type="button" (click)="onCancel()"
        class="px-5 py-2.5 rounded-xl border border-border text-text-secondary hover:bg-surface-elevated hover:text-text-primary transition-all text-sm font-medium">Cancel</button>
      <button type="button" (click)="onSubmit()" [disabled]="educationForm.invalid || isSubmitting()"
        class="px-5 py-2.5 rounded-xl bg-primary text-white hover:bg-primary-hover shadow-lg shadow-primary/25 hover:shadow-primary/40 transition-all text-sm font-medium flex items-center justify-center gap-2 transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
        <span *ngIf="isSubmitting()" class="loading loading-spinner loading-xs"></span>
        <i class="fa-regular fa-floppy-disk" *ngIf="!isSubmitting()"></i>
        <span>{{ isEditMode() ? 'Save Changes' : 'Add Education' }}</span>
      </button>
    </div>
  </div>

  <!-- Main Scrollable Content -->
  <div class="flex-1 overflow-y-auto custom-scrollbar min-h-0 pb-10">
    <div class="max-w-6xl mx-auto">
      <form [formGroup]="educationForm" class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <!-- Left Column: Main info -->
        <div class="lg:col-span-2 space-y-8">

          <!-- Academic Details Card -->
          <div class="glass-panel p-6 sm:p-8 rounded-2xl border border-border/50 bg-surface">
            <div class="flex items-center gap-3 mb-6">
              <div class="w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary">
                <i class="fa-solid fa-school text-lg"></i>
              </div>
              <h2 class="text-lg font-bold text-text-primary">Academic Details</h2>
            </div>

            <div class="grid grid-cols-1 gap-6">

              <!-- Institution -->
              <div class="space-y-1.5 relative">
                <label
                  class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Institution</label>
                <input type="text" formControlName="institution" placeholder="University or College Name"
                  class="w-full px-4 py-3 rounded-xl bg-surface-elevated/50 border border-border/60 focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none text-text-primary placeholder:text-text-tertiary transition-all"
                  (blur)="onBlur()" [class.border-red-500]="f['institution'].touched && f['institution'].invalid" />

                <!-- Suggestions Dropdown -->
                <div *ngIf="showSuggestions && instituteSuggestions.length > 0"
                  class="absolute top-full left-0 w-full bg-surface-elevated border border-border/50 rounded-xl shadow-xl mt-1 z-50 max-h-60 overflow-y-auto custom-scrollbar animate-fade-in">
                  <button *ngFor="let suggestion of instituteSuggestions" (click)="selectInstitute(suggestion)"
                    type="button"
                    class="w-full text-left px-4 py-3 hover:bg-primary/10 flex items-center gap-3 border-b border-border/10 last:border-0 transition-colors">
                    <div class="w-8 h-8 rounded bg-white p-1 flex items-center justify-center shadow-sm">
                      <img [src]="suggestion.logo_url" class="max-w-full max-h-full object-contain" />
                    </div>
                    <div>
                      <div class="text-sm font-semibold text-text-primary">{{ suggestion.name }}</div>
                      <div class="text-xs text-text-tertiary">{{ suggestion.domain || 'Institution' }}</div>
                    </div>
                  </button>
                </div>

                <span class="text-red-500 text-xs ml-1"
                  *ngIf="f['institution'].touched && f['institution'].invalid">Institution is required</span>
              </div>

              <!-- Degree & Field -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-1.5">
                  <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Degree</label>
                  <input type="text" formControlName="degree" placeholder="e.g. Bachelor's"
                    class="w-full px-4 py-3 rounded-xl bg-surface-elevated/50 border border-border/60 focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none text-text-primary placeholder:text-text-tertiary transition-all"
                    [class.border-red-500]="f['degree'].touched && f['degree'].invalid" />
                  <span class="text-red-500 text-xs ml-1"
                    *ngIf="f['degree'].touched && f['degree'].invalid">Required</span>
                </div>

                <div class="space-y-1.5">
                  <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Field of
                    Study</label>
                  <input type="text" formControlName="fieldOfStudy" placeholder="e.g. Computer Science"
                    class="w-full px-4 py-3 rounded-xl bg-surface-elevated/50 border border-border/60 focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none text-text-primary placeholder:text-text-tertiary transition-all"
                    [class.border-red-500]="f['fieldOfStudy'].touched && f['fieldOfStudy'].invalid" />
                  <span class="text-red-500 text-xs ml-1"
                    *ngIf="f['fieldOfStudy'].touched && f['fieldOfStudy'].invalid">Required</span>
                </div>
              </div>

              <!-- Grade & Location -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-1.5">
                  <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Grade /
                    GPA</label>
                  <input type="text" formControlName="grade" placeholder="e.g. 3.8 / 4.0"
                    class="w-full px-4 py-3 rounded-xl bg-surface-elevated/50 border border-border/60 focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none text-text-primary placeholder:text-text-tertiary transition-all" />
                </div>

                <div class="space-y-1.5">
                  <label
                    class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Location</label>
                  <div class="relative">
                    <input type="text" formControlName="location" placeholder="City, Country"
                      class="w-full pl-10 pr-4 py-3 rounded-xl bg-surface-elevated/50 border border-border/60 focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none text-text-primary placeholder:text-text-tertiary transition-all" />
                    <i
                      class="fa-solid fa-location-dot absolute left-3.5 top-1/2 -translate-y-1/2 text-text-tertiary"></i>
                  </div>
                </div>
              </div>

              <!-- Description -->
              <div class="space-y-1.5">
                <label
                  class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Description</label>
                <textarea formControlName="description"
                  class="w-full px-4 py-3 rounded-xl bg-surface-elevated/50 border border-border/60 focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none text-text-primary placeholder:text-text-tertiary transition-all min-h-[120px] resize-y"
                  placeholder="Brief description of your studies, thesis, or focus areas..."></textarea>
              </div>
            </div>
          </div>

          <!-- Highlights Card (Skills, Activities, Achievements) -->
          <div class="glass-panel p-6 sm:p-8 rounded-2xl border border-border/50 bg-surface">
            <div class="flex items-center gap-3 mb-6">
              <div class="w-10 h-10 rounded-xl bg-secondary/10 flex items-center justify-center text-secondary">
                <i class="fa-solid fa-lightbulb text-lg"></i>
              </div>
              <h2 class="text-lg font-bold text-text-primary">Highlights</h2>
            </div>

            <div class="space-y-8">

              <!-- Skills -->
              <div class="space-y-3">
                <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Skills
                  Learned</label>
                <div class="relative group">
                  <input #skillInput type="text" placeholder="Add skill (Press Enter)..."
                    class="w-full pl-4 pr-12 py-3 rounded-xl bg-surface-elevated/50 border border-border/60 focus:border-secondary focus:ring-1 focus:ring-secondary/20 outline-none text-text-primary placeholder:text-text-tertiary transition-all"
                    (keyup.enter)="addSkill(skillInput.value, skillInput)" />
                  <button type="button"
                    class="absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 flex items-center justify-center rounded-lg bg-secondary/10 text-secondary hover:bg-secondary hover:text-white transition-all shadow-sm opacity-0 group-focus-within:opacity-100"
                    (click)="addSkill(skillInput.value, skillInput)">
                    <i class="fa-solid fa-plus"></i>
                  </button>
                </div>

                <div class="flex flex-wrap gap-2 mt-2">
                  <div *ngFor="let skill of skills.controls; let i = index"
                    class="group flex items-center gap-1.5 pl-3 pr-1 py-1.5 rounded-lg bg-surface-elevated border border-border/60 text-xs font-medium text-text-secondary">
                    {{ skill.value }}
                    <button type="button" (click)="removeSkill(i)"
                      class="w-5 h-5 flex items-center justify-center rounded text-text-tertiary hover:text-red-500 transition-colors">
                      <i class="fa-solid fa-xmark text-[10px]"></i>
                    </button>
                  </div>
                  <div *ngIf="skills.length === 0" class="text-sm text-text-tertiary italic p-2 opacity-60">
                    No skills added yet.
                  </div>
                </div>
              </div>

              <div class="h-px bg-border/40"></div>

              <!-- Activities -->
              <div class="space-y-3">
                <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Activities &
                  Societies</label>
                <div class="relative group">
                  <input #activityInput type="text" placeholder="Add activity..."
                    class="w-full pl-4 pr-12 py-3 rounded-xl bg-surface-elevated/50 border border-border/60 focus:border-secondary focus:ring-1 focus:ring-secondary/20 outline-none text-text-primary placeholder:text-text-tertiary transition-all"
                    (keyup.enter)="addActivity(activityInput.value, activityInput)" />
                  <button type="button"
                    class="absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 flex items-center justify-center rounded-lg bg-secondary/10 text-secondary hover:bg-secondary hover:text-white transition-all shadow-sm opacity-0 group-focus-within:opacity-100"
                    (click)="addActivity(activityInput.value, activityInput)">
                    <i class="fa-solid fa-plus"></i>
                  </button>
                </div>

                <div class="flex flex-wrap gap-2 mt-2">
                  <div *ngFor="let act of activities.controls; let i = index"
                    class="group flex items-center gap-1.5 pl-3 pr-1 py-1.5 rounded-lg bg-surface border border-border/40 text-xs font-medium text-text-secondary">
                    {{ act.value }}
                    <button type="button" (click)="removeActivity(i)"
                      class="w-5 h-5 flex items-center justify-center rounded text-text-tertiary hover:text-red-500 transition-colors">
                      <i class="fa-solid fa-xmark text-[10px]"></i>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Achievements -->
              <div class="space-y-3">
                <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Key
                  Achievements</label>
                <div class="relative group">
                  <input #achieveInput type="text" placeholder="Add an achievement..."
                    class="w-full pl-4 pr-12 py-3 rounded-xl bg-surface-elevated/50 border border-border/60 focus:border-secondary focus:ring-1 focus:ring-secondary/20 outline-none text-text-primary placeholder:text-text-tertiary transition-all"
                    (keyup.enter)="addAchievement(achieveInput.value, achieveInput)" />
                  <button type="button"
                    class="absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 flex items-center justify-center rounded-lg bg-secondary/10 text-secondary hover:bg-secondary hover:text-white transition-all shadow-sm opacity-0 group-focus-within:opacity-100"
                    (click)="addAchievement(achieveInput.value, achieveInput)">
                    <i class="fa-solid fa-plus"></i>
                  </button>
                </div>

                <div class="space-y-2 mt-2">
                  <div *ngFor="let item of achievements.controls; let i = index"
                    class="flex items-start gap-3 p-3 rounded-xl bg-surface-elevated/30 hover:bg-surface-elevated/60 border border-border/30 transition-all group">
                    <span class="text-secondary mt-1">â€¢</span>
                    <span class="flex-1 text-sm text-text-secondary">{{ item.value }}</span>
                    <button type="button" (click)="removeAchievement(i)"
                      class="w-6 h-6 flex items-center justify-center rounded-full text-text-tertiary hover:bg-red-500/10 hover:text-red-500 transition-colors opacity-0 group-hover:opacity-100">
                      <i class="fa-solid fa-times text-xs"></i>
                    </button>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Right Column: Sidebar -->
        <div class="space-y-6">

          <!-- Timeline Card -->
          <div class="glass-panel p-6 rounded-2xl border border-border/50 bg-surface">
            <h2 class="text-xs font-bold text-text-tertiary uppercase tracking-widest mb-4">Timeline</h2>

            <div class="space-y-5">
              <div class="space-y-1.5">
                <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Start
                  Date</label>
                <input type="date" formControlName="startDate"
                  class="w-full px-4 py-3 rounded-xl bg-surface-elevated/50 border border-border/60 focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none text-text-primary transition-all unstyled-date"
                  [class.border-red-500]="f['startDate'].touched && f['startDate'].invalid" />
              </div>

              <div
                class="flex items-center gap-3 p-3 rounded-xl bg-surface-elevated/30 border border-border/30 cursor-pointer hover:bg-surface-elevated/50 transition-colors"
                (click)="f['current'].setValue(!f['current'].value)">
                <input type="checkbox" formControlName="current"
                  class="checkbox checkbox-primary checkbox-sm pointer-events-none" />
                <span class="text-sm font-medium text-text-primary select-none">I currently study here</span>
              </div>

              <div class="space-y-1.5 animate-fade-in" *ngIf="!f['current'].value">
                <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">End Date</label>
                <input type="date" formControlName="endDate"
                  class="w-full px-4 py-3 rounded-xl bg-surface-elevated/50 border border-border/60 focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none text-text-primary transition-all unstyled-date" />
              </div>
            </div>
          </div>

          <!-- Links & Logo Card -->
          <div class="glass-panel p-6 rounded-2xl border border-border/50 bg-surface">
            <h2 class="text-xs font-bold text-text-tertiary uppercase tracking-widest mb-4">Links & media</h2>

            <div class="space-y-5">
              <!-- Website -->
              <div class="space-y-1.5">
                <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Website
                  URL</label>
                <input type="text" formControlName="website" placeholder="https://..."
                  class="w-full px-4 py-3 rounded-xl bg-surface-elevated/50 border border-border/60 focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none text-text-primary placeholder:text-text-tertiary transition-all" />
              </div>

              <!-- Logo -->
              <div class="space-y-1.5">
                <label class="text-xs font-semibold text-text-secondary uppercase tracking-wider ml-1">Institution
                  Logo</label>
                <div
                  class="relative w-full aspect-square md:h-40 rounded-xl border-2 border-dashed border-border hover:border-primary/50 hover:bg-surface-elevated/50 transition-all flex flex-col items-center justify-center p-4 group cursor-pointer bg-surface-elevated/20 overflow-hidden">
                  <input type="file" accept="image/*" (change)="onLogoSelected($event)"
                    class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />

                  <!-- Placeholder -->
                  <div
                    class="flex flex-col items-center gap-3 text-text-tertiary group-hover:text-primary transition-colors"
                    *ngIf="!educationForm.get('logo')?.value">
                    <div class="w-12 h-12 rounded-full bg-surface-elevated flex items-center justify-center shadow-sm">
                      <i class="fa-solid fa-university text-xl opacity-60"></i>
                    </div>
                    <span class="text-xs font-semibold uppercase tracking-wide">Upload Logo</span>
                  </div>

                  <!-- Preview -->
                  <div *ngIf="educationForm.get('logo')?.value"
                    class="w-full h-full p-4 flex items-center justify-center">
                    <img [src]="educationForm.get('logo')?.value"
                      class="max-w-full max-h-full object-contain drop-shadow-sm" />
                    <button type="button" (click)="$event.stopPropagation(); educationForm.get('logo')?.setValue('')"
                      class="absolute top-2 right-2 btn btn-circle btn-xs btn-error text-white shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-20">
                      <i class="fa-solid fa-xmark"></i>
                    </button>
                  </div>
                </div>
                <div class="space-y-1.5 mt-2">
                  <label class="text-[10px] font-bold text-text-tertiary uppercase tracking-wider ml-1">OR ENTER
                    URL</label>
                  <input type="text" formControlName="logo" placeholder="https://..."
                    class="w-full px-3 py-2 rounded-lg bg-surface-elevated/50 border border-border/60 text-xs text-text-primary focus:border-primary outline-none" />
                </div>
              </div>
            </div>
          </div>

        </div>

      </form>
    </div>
  </div>
</div>