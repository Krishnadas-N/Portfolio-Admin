<div class="container mx-auto p-4 lg:p-8 max-w-7xl">
  
  <!-- Header -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8 sticky top-0 z-20 bg-base-100/80 backdrop-blur-md py-4 -mx-4 px-4 sm:mx-0 sm:px-0 border-b border-base-200 sm:border-none">
    <div>
      <h1 class="text-3xl font-bold text-base-content tracking-tight">Education</h1>
      <p class="text-base-content/60 text-sm mt-1">Manage your academic background and qualifications.</p>
    </div>
    
    <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto">
      <div class="join w-full sm:w-auto shadow-sm">
        <div class="relative w-full sm:w-64">
          <input type="text" [(ngModel)]="searchTerm" (keyup.enter)="onSearch()" 
                 placeholder="Search education..." 
                 class="input input-bordered join-item w-full pl-10 focus:input-primary transition-all bg-base-100 placeholder:text-base-content/40" />
          <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-base-content/40"></i>
        </div>
        <button (click)="onSearch()" class="btn btn-primary join-item px-6">Search</button>
      </div>
      
      <a routerLink="/education/add" class="btn btn-primary shadow-lg shadow-primary/20 shrink-0 gap-2">
        <i class="fa-solid fa-plus"></i> Add New
      </a>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading()" class="space-y-6">
    <div *ngFor="let i of [1,2,3]" class="card bg-base-100 shadow-sm border border-base-200 p-6 animate-pulse">
      <div class="flex gap-4">
        <div class="h-16 w-16 bg-base-200 rounded-xl"></div>
        <div class="flex-1 space-y-2">
          <div class="h-6 bg-base-200 w-1/3 rounded"></div>
          <div class="h-4 bg-base-200 w-1/4 rounded"></div>
          <div class="h-4 bg-base-200 w-1/2 rounded"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading() && !error() && educations().length === 0" class="flex flex-col items-center justify-center py-24 bg-base-100 rounded-3xl border-2 border-dashed border-base-200 text-center">
    <div class="w-24 h-24 bg-base-200/50 rounded-full flex items-center justify-center mb-6 text-base-content/20">
      <i class="fa-solid fa-graduation-cap text-4xl"></i>
    </div>
    <h3 class="text-xl font-bold text-base-content">No education added</h3>
    <p class="text-base-content/60 max-w-xs mt-2 mb-8">Add your educational background to complete your profile.</p>
    <a routerLink="/education/add" class="btn btn-primary">Add Education</a>
  </div>

  <!-- Timeline Layout -->
  <div *ngIf="!isLoading() && educations().length > 0" class="relative pl-8 sm:pl-10 space-y-8">
    
    <!-- Timeline Line -->
    <div class="absolute left-3 sm:left-4 top-4 bottom-4 w-0.5 bg-base-300"></div>

    <div *ngFor="let edu of educations()" class="relative group">
      <!-- Timeline Dot -->
      <div class="absolute -left-[29px] sm:-left-[33px] top-6 w-4 h-4 rounded-full bg-primary border-4 border-base-100 shadow-sm z-10 group-hover:scale-125 transition-transform duration-300"></div>

      <div class="card bg-base-100 shadow-sm hover:shadow-xl transition-all duration-300 border border-base-200/60 overflow-hidden">
        <div class="card-body p-6">
          <div class="flex flex-col sm:flex-row gap-6">
            
            <!-- Logo -->
            <div class="w-16 h-16 rounded-xl bg-base-200/50 border border-base-200 p-2 shrink-0 flex items-center justify-center overflow-hidden">
               <img [src]="edu.logo || 'assets/images/placeholder-edu.png'" [alt]="edu.institution" class="w-full h-full object-contain" />
            </div>

            <!-- Content -->
            <div class="flex-1 min-w-0 space-y-2">
              <div class="flex flex-col sm:flex-row sm:items-start justify-between gap-4">
                <div>
                  <h2 class="text-xl font-bold text-base-content leading-tight">{{ edu.degree }}</h2>
                  <p class="text-base font-medium text-primary mt-1">{{ edu.institution }}</p>
                  <p class="text-sm text-base-content/60">{{ edu.fieldOfStudy }} <span *ngIf="edu.gpa" class="mx-1">â€¢</span> {{ edu.gpa }}</p>
                </div>
                
                <div class="flex flex-col sm:items-end gap-2 shrink-0">
                   <div class="badge badge-lg bg-base-200 border-none font-medium text-xs">
                      {{ edu.startDate | date:'MMM y' }} - {{ edu.isCurrent ? 'Present' : (edu.endDate | date:'MMM y') }}
                   </div>
                   <span class="text-xs text-base-content/50 flex items-center gap-1" *ngIf="edu.location">
                      <i class="fa-solid fa-location-dot"></i> {{ edu.location }}
                   </span>
                   <a *ngIf="edu.website" [href]="edu.website" target="_blank" class="text-xs text-primary flex items-center gap-1 hover:underline">
                      <i class="fa-solid fa-link"></i> Website
                   </a>
                </div>
              </div>

              <!-- Description -->
              <p class="text-sm text-base-content/70 leading-relaxed mt-4 bg-base-50/50 p-3 rounded-lg border border-base-100" *ngIf="edu.description">
                 {{ edu.description }}
              </p>

              <!-- Achievements -->
              <div *ngIf="edu.achievements && edu.achievements.length > 0" class="mt-4">
                 <span class="text-xs font-bold text-base-content/40 uppercase tracking-wider block mb-2">Achievements</span>
                 <ul class="list-disc list-outside ml-4 space-y-1">
                    <li *ngFor="let achieve of edu.achievements" class="text-sm text-base-content/70 pl-1">{{ achieve }}</li>
                 </ul>
              </div>

              <!-- Skills & Activities -->
              <div class="flex flex-wrap gap-4 mt-4 pt-4 border-t border-base-200/50">
                 <div *ngIf="edu.gpa">
                    <span class="text-xs font-bold text-base-content/40 uppercase tracking-wider block mb-2">GPA</span>
                    <span class="badge badge-sm badge-outline font-mono">{{ edu.gpa }}</span>
                 </div>
                 <div *ngIf="edu.skills && edu.skills.length > 0">
                    <span class="text-xs font-bold text-base-content/40 uppercase tracking-wider block mb-2">Skills</span>
                    <div class="flex flex-wrap gap-1.5">
                       <span *ngFor="let skill of edu.skills || []" class="badge badge-sm bg-primary/10 text-primary border-primary/10">
                          {{ skill }}
                       </span>
                    </div>
                 </div>
                 
                  <div *ngIf="edu.activities && edu.activities.length > 0">
                    <span class="text-xs font-bold text-base-content/40 uppercase tracking-wider block mb-2">Activities</span>
                    <div class="flex flex-wrap gap-1.5">
                       <span *ngFor="let activity of edu.activities" class="badge badge-sm badge-ghost">
                          {{ activity }}
                       </span>
                    </div>
                 </div>
              </div>
            </div>

            <!-- Actions -->
            <div class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex gap-2">
               <a [routerLink]="['/education/edit', edu._id]" class="btn btn-sm btn-square btn-ghost hover:bg-base-200" title="Edit">
                  <i class="fa-solid fa-pen-to-square"></i>
               </a>
               <button (click)="deleteEducation(edu._id!)" class="btn btn-sm btn-square btn-ghost text-error hover:bg-error/10" title="Delete">
                  <i class="fa-regular fa-trash-can"></i>
               </button>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="!isLoading() && pagination()" class="mt-10 pt-6">
    <app-pagination [pagination]="pagination()!" (pageChange)="onPageChange($event)"></app-pagination>
  </div>
</div>
