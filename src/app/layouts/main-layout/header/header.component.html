<div class="flex items-center justify-between w-full h-full gap-4">

  <!-- Mobile Toggle (Visible only on mobile) -->
  <div class="flex-none lg:hidden">
    <label for="drawer-toggle"
      class="btn btn-square btn-ghost text-text-secondary hover:text-primary hover:bg-primary/10 transition-colors">
      <i class="fa-solid fa-bars text-xl"></i>
    </label>
  </div>

  <!-- Search Bar -->
  <div class="hidden md:flex flex-1 max-w-lg">
    <div class="relative w-full group">
      <i
        class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-text-tertiary group-focus-within:text-primary transition-colors text-sm"></i>
      <input type="text" placeholder="Search anything..." class="w-full pl-11 pr-4 py-2.5 
                    bg-surface-elevated/50 
                    border border-border/50 
                    rounded-2xl 
                    text-sm text-text-primary 
                    placeholder:text-text-tertiary/70 
                    focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary/50 
                    transition-all duration-300
                    shadow-sm" />
      <div class="absolute right-3 top-1/2 -translate-y-1/2 flex gap-1">
        <kbd
          class="hidden lg:inline-flex items-center gap-1 px-1.5 py-0.5 rounded border border-border bg-surface text-[0.6rem] font-medium text-text-tertiary">
          <span class="text-xs">âŒ˜</span>K
        </kbd>
      </div>
    </div>
  </div>

  <!-- Spacer for mobile layout -->
  <div class="flex-1 md:hidden"></div>

  <!-- Right Actions -->
  <div class="flex items-center gap-2">

    <!-- Theme Toggle -->
    <button (click)="themeService.toggle()"
      class="hidden sm:flex btn btn-circle btn-ghost btn-sm text-text-secondary hover:text-primary hover:bg-primary/10 transition-all duration-300"
      [title]="themeService.theme() === 'dark' ? 'Switch to light mode' : 'Switch to dark mode'">
      <i [class]="themeService.theme() === 'dark' ? 'fa-solid fa-sun' : 'fa-solid fa-moon'" class="text-lg"></i>
    </button>

    <!-- Notifications -->
    <div class="relative">
      <button (click)="toggleNotifications()"
        class="btn btn-circle btn-ghost btn-sm text-text-secondary hover:text-primary hover:bg-primary/10 transition-all duration-300 relative group">
        <div class="relative">
          <i class="fa-regular fa-bell text-lg group-hover:animate-swing"></i>
          <span *ngIf="notificationService.unreadCount() > 0"
            class="absolute -top-1 -right-1 w-2.5 h-2.5 rounded-full bg-red-500 ring-2 ring-surface animate-pulse flex items-center justify-center">
            <!-- <span class="text-[8px] text-white font-bold leading-none">{{ notificationService.unreadCount() }}</span> -->
          </span>
        </div>
      </button>

      <!-- Dropdown Panel -->
      <div *ngIf="showNotifications()"
        class="absolute right-0 top-full mt-4 w-80 sm:w-96 bg-surface-elevated/95 backdrop-blur-xl border border-border/60 rounded-2xl shadow-2xl z-50 transform origin-top-right transition-all animate-fade-in-up">

        <!-- Header -->
        <div class="flex items-center justify-between p-4 border-b border-border/50">
          <div class="flex items-center gap-2">
            <h3 class="font-bold text-text-primary">Notifications</h3>
            <span *ngIf="notificationService.unreadCount() > 0"
              class="bg-primary/10 text-primary text-[10px] font-bold px-2 py-0.5 rounded-full">
              {{ notificationService.unreadCount() }} New
            </span>
          </div>
          <div class="flex gap-2">
            <button (click)="markAllRead()"
              class="text-xs text-text-tertiary hover:text-primary transition-colors font-medium">
              Read All
            </button>
            <button (click)="clearAll()"
              class="text-xs text-text-tertiary hover:text-red-500 transition-colors font-medium">
              Clear
            </button>
          </div>
        </div>

        <!-- List -->
        <div class="max-h-[400px] z-50 overflow-y-auto custom-scrollbar">
          <!-- Empty State -->
          <div *ngIf="notificationService.notifications().length === 0"
            class="p-8 text-center flex flex-col items-center">
            <div
              class="w-16 h-16 bg-surface/50 rounded-full flex items-center justify-center mb-3 text-text-tertiary/50">
              <i class="fa-regular fa-bell-slash text-2xl"></i>
            </div>
            <p class="text-text-secondary font-medium text-sm">No notifications</p>
            <p class="text-text-tertiary text-xs mt-1">You're all caught up!</p>
          </div>

          <!-- Items -->
          <div *ngFor="let item of notificationService.notifications()"
            class="p-4 z-99 border-b border-border/30 hover:bg-surface/50 transition-colors relative group cursor-pointer"
            [ngClass]="{'bg-primary/5': !item.read}">
            <div class="flex gap-3">
              <!-- Icon -->
              <div class="shrink-0 w-10 h-10 rounded-full flex items-center justify-center mt-1" [ngClass]="{
                      'bg-blue-500/10 text-blue-500': item.type === 'info',
                      'bg-emerald-500/10 text-emerald-500': item.type === 'success',
                      'bg-amber-500/10 text-amber-500': item.type === 'warning',
                      'bg-red-500/10 text-red-500': item.type === 'error'
                    }">
                <i [class]="item.icon || 'fa-solid fa-circle-info'"></i>
              </div>

              <div class="flex-1 min-w-0">
                <p class="text-sm font-semibold text-text-primary truncate pr-4">{{ item.title }}</p>
                <p class="text-xs text-text-secondary mt-0.5 line-clamp-2 leading-relaxed">{{ item.message }}</p>
                <p class="text-[10px] text-text-tertiary mt-2 flex items-center gap-1">
                  <i class="fa-regular fa-clock"></i> {{ item.time }}
                </p>
              </div>

              <!-- Interaction -->
              <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
                <button (click)="removeNotification(item.id, $event)"
                  class="w-6 h-6 rounded-full hover:bg-red-500/10 text-text-tertiary hover:text-red-500 flex items-center justify-center transition-colors">
                  <i class="fa-solid fa-xmark text-xs"></i>
                </button>
              </div>

              <!-- Unread Dot -->
              <div *ngIf="!item.read"
                class="absolute top-4 right-4 w-2 h-2 rounded-full bg-primary ring-4 ring-surface/0 group-hover:opacity-0 transition-opacity">
              </div>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <!-- <div class="p-2 border-t border-border/50 bg-surface/30">
          <a routerLink="/notifications" class="block w-full text-center py-2 text-xs font-semibold text-text-secondary hover:text-primary transition-colors rounded-lg hover:bg-surface">
            View All Notifications
          </a>
        </div> -->
      </div>
    </div>

    <!-- Vertical Separator -->
    <div class="w-px h-8 bg-border/50 mx-1 hidden sm:block"></div>

    <!-- User Profile -->
    <!-- User Profile Dropdown -->
    <div class="relative">
      <div (click)="toggleUserMenu()"
        class="flex items-center gap-3 pl-1 cursor-pointer p-1.5 rounded-xl hover:bg-surface-elevated/50 transition-all duration-300 group select-none">
        <div class="relative">
          <div
            class="w-9 h-9 rounded-xl overflow-hidden ring-2 ring-surface group-hover:ring-primary/30 transition-all">
            <img [src]="user()?.profileImage || 'assets/images/profile.png'" class="w-full h-full object-cover"
              alt="User" />
          </div>
          <div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-emerald-500 border-2 border-surface rounded-full"></div>
        </div>

        <div class="hidden md:flex flex-col items-start mr-2">
          <span class="text-xs font-bold text-text-primary leading-tight group-hover:text-primary transition-colors">
            {{ user()?.username || 'Administrator' }}
          </span>
          <span class="text-[0.65rem] font-semibold text-text-tertiary uppercase tracking-wider">
            {{ user()?.role || 'Admin' }}
          </span>
        </div>

        <i class="fa-solid fa-chevron-down text-[0.7rem] text-text-tertiary hidden md:block group-hover:text-primary transition-colors duration-300"
          [class.rotate-180]="showUserMenu()"></i>
      </div>

      <!-- User Menu -->
      <div *ngIf="showUserMenu()"
        class="absolute right-0 top-full mt-2 w-48 bg-surface-elevated/95 backdrop-blur-xl border border-border/60 rounded-xl shadow-xl z-50 transform origin-top-right transition-all animate-fade-in-up overflow-hidden">

        <div class="p-2 border-b border-border/50 md:hidden">
          <div class="px-3 py-2">
            <p class="text-sm font-bold text-text-primary">{{ user()?.username || 'Administrator' }}</p>
            <p class="text-xs text-text-tertiary">{{ user()?.role || 'Admin' }}</p>
          </div>
        </div>

        <ul class="py-1">
          <li>
            <button (click)="logout()"
              class="w-full flex items-center gap-3 px-4 py-2.5 text-sm text-red-500 hover:bg-red-500/10 transition-colors cursor-pointer text-left">
              <i class="fa-solid fa-arrow-right-from-bracket w-4 text-center"></i>
              Logout
            </button>
          </li>
        </ul>
      </div>
    </div>

  </div>
</div>