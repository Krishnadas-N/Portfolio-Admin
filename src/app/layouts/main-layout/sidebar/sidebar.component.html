<div class="h-full flex flex-col bg-base-100 text-base-content border-r border-base-200 transition-all duration-300 ease-in-out"
     [class.w-80]="!isCollapsed()"
     [class.w-20]="isCollapsed()">
  
  <!-- Header (Brand + Toggle) -->
  <div class="h-16 flex items-center px-4 border-b border-base-200 relative shrink-0">
    <!-- Logo & Text -->
    <div class="flex items-center gap-3 overflow-hidden whitespace-nowrap transition-all duration-300"
         [class.w-auto]="!isCollapsed()"
         [class.w-0]="isCollapsed()"
         [class.opacity-0]="isCollapsed()"
         [class.mr-0]="isCollapsed()">
      <div class="w-9 h-9 shrink-0 rounded-xl bg-gradient-to-br from-primary to-primary-focus flex items-center justify-center text-white font-bold text-lg shadow-lg shadow-primary/30">
        P
      </div>
      <div>
        <div class="text-[0.9375rem] font-bold leading-tight text-base-content">
          Portfolio
        </div>
        <div class="text-[0.625rem] font-semibold uppercase tracking-wider text-base-content/60 mt-px">
          Admin
        </div>
      </div>
    </div>

    <!-- Toggle Button (Absolute to stay fixed) -->
    <button
        (click)="toggleCollapse()"
        class="btn btn-sm btn-ghost btn-square
              text-base-content/60
              hover:text-primary
              hover:bg-primary/10
              transition-colors
              absolute right-2 top-1/2 -translate-y-1/2"
        [attr.title]="isCollapsed() ? 'Expand' : 'Collapse'"
      >
        <i
          class="fa-solid text-lg transition-transform duration-300"
          [class.fa-angles-left]="!isCollapsed()"
          [class.fa-bars]="isCollapsed()"
        ></i>
      </button>

  </div>

  <!-- Navigation -->
  <nav class="flex-1 overflow-y-auto overflow-x-hidden p-3 custom-scrollbar">
    <ul class="menu w-full p-0 gap-1">
      <ng-container *ngFor="let item of menuItems">
        
        <!-- Section Header -->
        <li *ngIf="item.type === 'header'" 
            class="menu-title text-xs font-bold uppercase tracking-widest text-base-content/50 mt-4 mb-1 px-3 whitespace-nowrap overflow-hidden transition-all duration-300"
            [class.opacity-0]="isCollapsed()"
            [class.h-0]="isCollapsed()"
            [class.mt-0]="isCollapsed()"
            [class.mb-0]="isCollapsed()">
          {{ item.title }}
        </li>

        <!-- Single Link -->
        <li *ngIf="item.type === 'link' && item.path">
          <a [routerLink]="item.path" 
             routerLinkActive="active"
             [routerLinkActiveOptions]="{exact: false}"
             class="group flex items-center gap-3 px-3 py-3 rounded-xl text-sm font-medium text-base-content/70 hover:bg-base-200 hover:text-base-content transition-all duration-200 relative overflow-hidden"
             [attr.title]="isCollapsed() ? item.title : ''">
            
            <div class="w-5 flex justify-center shrink-0">
               <i [class]="item.icon" class="text-center text-lg transition-colors group-hover:text-primary"></i>
            </div>

            <span class="flex-1 whitespace-nowrap transition-all duration-300 origin-left"
                  [class.opacity-0]="isCollapsed()"
                  [class.translate-x-4]="isCollapsed()"
                  [class.w-0]="isCollapsed()">{{ item.title }}</span>
            
            <!-- Tooltip -->
            <div *ngIf="isCollapsed()" class="absolute left-full top-1/2 -translate-y-1/2 ml-3 px-2 py-1 bg-base-300 rounded text-xs font-medium text-base-content whitespace-nowrap opacity-0 group-hover:opacity-100 pointer-events-none z-50 transition-opacity shadow-sm">
              {{ item.title }}
            </div>
          </a>
        </li>

        <!-- Group -->
        <li *ngIf="item.type === 'group'">
          <details [open]="!isCollapsed() && isGroupOpen(item.title)" class="group/details">
            <summary (click)="toggleGroup(item.title)" 
                     class="group flex items-center gap-3 px-3 py-3 rounded-xl text-sm font-medium text-base-content/70 hover:bg-base-200 hover:text-base-content transition-all duration-200 select-none overflow-hidden relative">
              
              <div class="w-5 flex justify-center shrink-0">
                  <i [class]="item.icon" class="text-center text-lg transition-colors group-hover:text-primary"></i>
              </div>

              <span class="flex-1 whitespace-nowrap transition-all duration-300 origin-left"
                    [class.opacity-0]="isCollapsed()"
                    [class.translate-x-4]="isCollapsed()"
                    [class.w-0]="isCollapsed()">{{ item.title }}</span>
              
              <i *ngIf="!isCollapsed()" 
                 class="fa-solid fa-chevron-right text-[0.6rem] transition-transform duration-200 group-open/details:rotate-90"></i>
            </summary>
            
            <ul class="mt-1 ml-2 border-l border-base-200 pl-2 before:hidden"
                [class.hidden]="isCollapsed()">
              <li *ngFor="let sub of item.children">
                <a [routerLink]="sub.path"
                   routerLinkActive="active"
                   class="flex items-center gap-2 px-3 py-2 rounded-lg text-[0.8125rem] text-base-content/60 hover:bg-base-200 hover:text-base-content transition-all duration-200">
                  <span class="nav-dot w-1.5 h-1.5 rounded-full bg-base-300 mr-2 group-[.active]:bg-primary transition-colors"></span>
                  <span>{{ sub.title }}</span>
                </a>
              </li>
            </ul>
          </details>
        </li>

      </ng-container>
    </ul>
  </nav>

  <!-- User Profile -->
  <div class="p-4 border-t border-base-200 bg-base-50/50 shrink-0">
    <div class="flex items-center gap-3 p-2 rounded-xl hover:bg-base-100 transition-all duration-200 group cursor-pointer overflow-hidden relative"
         [class.justify-center]="isCollapsed()">
      <div class="relative shrink-0">
        <img class="w-10 h-10 rounded-lg object-cover border-2 border-base-100 shadow-sm" 
             [src]="user()?.profileImage || 'assets/images/profile.png'" 
             alt="">
        <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full bg-success border-2 border-base-100"></div>
      </div>
      
      <div class="flex-1 min-w-0 transition-all duration-300 whitespace-nowrap"
           [class.opacity-0]="isCollapsed()"
           [class.translate-x-4]="isCollapsed()"
           [class.w-0]="isCollapsed()">
        <p class="text-sm font-semibold text-base-content truncate group-hover:text-primary transition-colors">
          {{ user()?.username || 'Admin' }}
        </p>
        <p class="text-xs text-base-content/60 truncate">
          {{ user()?.role || 'Administrator' }}
        </p>
      </div>
      
      <button (click)="logout()" 
              *ngIf="!isCollapsed()"
              class="p-2 rounded-lg text-base-content/40 hover:text-error hover:bg-error/10 transition-colors shrink-0"
              title="Logout">
        <i class="fa-solid fa-arrow-right-from-bracket text-sm"></i>
      </button>
    </div>
  </div>
</div>