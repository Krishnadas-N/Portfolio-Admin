<div class="h-full flex flex-col bg-transparent text-text-primary transition-all duration-300 ease-in-out"
  [class.w-72]="!isCollapsed()" [class.w-20]="isCollapsed()">

  <!-- Header (Brand + Toggle) -->
  <div class="h-16 flex items-center px-4 border-b border-border/50 relative shrink-0">
    <!-- Logo & Text -->
    <div class="flex items-center gap-3 overflow-hidden whitespace-nowrap transition-all duration-300"
      [class.w-auto]="!isCollapsed()" [class.w-10]="isCollapsed()" [class.mr-0]="isCollapsed()">

      <div
        class="w-10 h-10 shrink-0 rounded-xl bg-gradient-to-br from-primary to-primary-hover flex items-center justify-center text-white font-bold text-lg shadow-lg shadow-primary/20 ring-1 ring-white/10 relative group cursor-pointer overflow-hidden">
        <div
          class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300">
        </div>
        <span class="relative z-10">P</span>
      </div>

      <div class="transition-all duration-300 origin-left" [class.opacity-0]="isCollapsed()"
        [class.scale-90]="isCollapsed()" [class.hidden]="isCollapsed()">
        <div class="text-base font-bold leading-tight text-text-primary tracking-tight">
          Portfolio
        </div>
        <div class="text-[0.65rem] font-semibold uppercase tracking-widest text-text-tertiary">
          Admin Console
        </div>
      </div>
    </div>

    <!-- Toggle Button -->
    <button (click)="toggleCollapse()"
      class="btn btn-sm btn-ghost btn-square
              text-text-secondary
              hover:text-primary
              hover:bg-primary/10
              transition-all duration-300
              absolute -right-3 top-1/2 -translate-y-1/2
              z-50 bg-surface border border-border/50 shadow-sm rounded-full w-6 h-6 flex items-center justify-center backdrop-blur-md hidden lg:flex"
      [attr.title]="isCollapsed() ? 'Expand' : 'Collapse'">
      <i class="fa-solid fa-chevron-left text-xs transition-transform duration-300"
        [class.rotate-180]="isCollapsed()"></i>
    </button>
  </div>

  <!-- Navigation -->
  <nav class="flex-1 overflow-y-auto overflow-x-hidden p-3 custom-scrollbar space-y-1">

    <!-- Collapsed State: Flatten Everything -->
    <ng-container *ngIf="isCollapsed()">
      <div class="flex flex-col gap-2 pt-2">
        <ng-container *ngFor="let item of menuItems">

          <!-- Header (Divider) -->
          <div *ngIf="item.type === 'header'" class="px-2 py-1">
            <div class="h-px bg-border/50 w-full mx-auto"></div>
          </div>

          <!-- Direct Link -->
          <div *ngIf="item.type === 'link' && item.path" class="relative group px-2">
            <a [routerLink]="item.path" routerLinkActive="active" [routerLinkActiveOptions]="{exact: false}"
              class="flex items-center justify-center w-10 h-10 mx-auto rounded-xl text-text-secondary hover:text-text-primary hover:bg-surface-elevated/50 transition-all duration-200 group-[.active]:bg-primary/10 group-[.active]:text-primary relative"
              [attr.title]="item.title">
              <i [class]="item.icon"
                class="text-lg transition-colors group-hover:text-primary group-[.active]:text-primary"></i>
            </a>

            <!-- Tooltip -->
            <div
              class="absolute left-full top-1/2 -translate-y-1/2 ml-3 px-3 py-1.5 bg-surface-elevated text-text-primary text-xs font-medium rounded-md shadow-lg border border-border/50 opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity z-50 whitespace-nowrap">
              {{ item.title }}
            </div>
          </div>

          <!-- Group (Flattened Children) -->
          <ng-container *ngIf="item.type === 'group'">
            <div *ngFor="let sub of item.children" class="relative group px-2">
              <a [routerLink]="sub.path" routerLinkActive="active"
                class="flex items-center justify-center w-10 h-10 mx-auto rounded-xl text-text-secondary hover:text-text-primary hover:bg-surface-elevated/50 transition-all duration-200 group-[.active]:bg-primary/10 group-[.active]:text-primary relative"
                [attr.title]="sub.title">
                <i [class]="sub.icon"
                  class="text-lg transition-colors group-hover:text-primary group-[.active]:text-primary"></i>
              </a>

              <!-- Tooltip -->
              <div
                class="absolute left-full top-1/2 -translate-y-1/2 ml-3 px-3 py-1.5 bg-surface-elevated text-text-primary text-xs font-medium rounded-md shadow-lg border border-border/50 opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity z-50 whitespace-nowrap">
                {{ sub.title }}
              </div>
            </div>
          </ng-container>

        </ng-container>
      </div>
    </ng-container>

    <!-- Expanded State -->
    <ng-container *ngIf="!isCollapsed()">
      <div class="flex flex-col gap-1 px-3 pb-4">
        <ng-container *ngFor="let item of menuItems">

          <!-- Section Header -->
          <div *ngIf="item.type === 'header'"
            class="px-3 mt-6 mb-1 text-xs font-bold text-text-tertiary uppercase tracking-widest opacity-80">
            {{ item.title }}
          </div>

          <!-- Single Link -->
          <div *ngIf="item.type === 'link' && item.path">
            <a [routerLink]="item.path" routerLinkActive="active" [routerLinkActiveOptions]="{exact: false}"
              class="group flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium text-text-secondary transition-all duration-200 hover:bg-surface-elevated hover:text-text-primary group-[.active]:bg-primary/10 group-[.active]:text-primary">

              <div
                class="w-5 flex justify-center shrink-0 text-lg opacity-80 transition-opacity group-hover:opacity-100 group-[.active]:opacity-100">
                <i [class]="item.icon"></i>
              </div>

              <span class="flex-1 tracking-wide truncate">
                {{ item.title }}
              </span>

              <!-- Active Pill -->
              <div class="w-1.5 h-1.5 rounded-full bg-primary opacity-0 group-[.active]:opacity-100 transition-opacity">
              </div>
            </a>
          </div>

          <!-- Group -->
          <div *ngIf="item.type === 'group'">
            <div class="flex flex-col rounded-xl transition-colors duration-200"
              [class.bg-surface-elevated-05]="isGroupOpen(item.title)">

              <!-- Group Toggle -->
              <div (click)="toggleGroup(item.title)"
                class="group flex items-center gap-3 px-3 py-2.5 rounded-xl cursor-pointer text-sm font-medium text-text-secondary hover:bg-surface-elevated hover:text-text-primary transition-all duration-200 select-none"
                [class.text-text-primary]="isGroupOpen(item.title)">

                <div
                  class="w-5 flex justify-center shrink-0 text-lg opacity-80 transition-opacity group-hover:opacity-100">
                  <i [class]="item.icon"></i>
                </div>

                <span class="flex-1 tracking-wide truncate">{{ item.title }}</span>

                <i class="fa-solid fa-chevron-right text-[0.65rem] text-text-tertiary transition-transform duration-300"
                  [class.rotate-90]="isGroupOpen(item.title)"></i>
              </div>

              <!-- Children -->
              <div *ngIf="isGroupOpen(item.title)" class="flex flex-col gap-0.5 mt-0.5 mb-1 animate-fade-in-down">
                <a *ngFor="let sub of item.children" [routerLink]="sub.path" routerLinkActive="active"
                  class="group/sub flex items-center gap-3 pl-11 pr-3 py-2 rounded-lg text-[0.85rem] font-medium text-text-secondary hover:text-text-primary hover:bg-surface-elevated/50 transition-all duration-200 group-[.active]:text-primary">

                  <div
                    class="w-4 flex justify-center shrink-0 text-sm opacity-60 transition-opacity group-hover/sub:opacity-100 group-[.active]:opacity-100">
                    <i [class]="sub.icon"></i>
                  </div>

                  <span class="truncate">{{ sub.title }}</span>
                </a>
              </div>
            </div>
          </div>

        </ng-container>
      </div>
    </ng-container>
  </nav>

  <!-- User Profile -->
  <div class="p-4 border-t border-border/50">
    <div
      class="flex items-center gap-3 p-2.5 rounded-xl hover:bg-surface-elevated/50 transition-all duration-200 group cursor-pointer relative"
      [class.justify-center]="isCollapsed()">

      <div class="relative shrink-0">
        <img class="w-9 h-9 rounded-lg object-cover ring-2 ring-surface"
          [src]="user()?.profileImage || 'assets/images/profile.png'" alt="">
        <span
          class="absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 rounded-full bg-emerald-500 ring-2 ring-surface"></span>
      </div>

      <div class="flex-1 min-w-0 transition-all duration-300" [class.opacity-0]="isCollapsed()"
        [class.hidden]="isCollapsed()">
        <p class="text-sm font-semibold text-text-primary truncate">
          {{ user()?.username || 'Admin User' }}
        </p>
        <p class="text-xs text-text-tertiary truncate">
          {{ user()?.role || 'Administrator' }}
        </p>
      </div>

      <button (click)="logout()" *ngIf="!isCollapsed()"
        class="w-8 h-8 flex items-center justify-center rounded-lg text-text-tertiary hover:text-red-500 hover:bg-red-500/10 transition-colors opacity-0 group-hover:opacity-100"
        title="Logout">
        <i class="fa-solid fa-power-off text-sm"></i>
      </button>
    </div>
  </div>
</div>